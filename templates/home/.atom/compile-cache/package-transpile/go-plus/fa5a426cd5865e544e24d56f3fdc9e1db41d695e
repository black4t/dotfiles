Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PANEL_URI = exports.GoPlusPanel = undefined;

var _etch = require('etch');

var _etch2 = _interopRequireDefault(_etch);

var _resizeObserverPolyfill = require('resize-observer-polyfill');

var _resizeObserverPolyfill2 = _interopRequireDefault(_resizeObserverPolyfill);

var _etchComponent = require('./../etch-component');

var _emptyTabView = require('./empty-tab-view');

var _etchOcticon = require('etch-octicon');

var _etchOcticon2 = _interopRequireDefault(_etchOcticon);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class GoPlusPanel extends _etchComponent.EtchComponent {

  constructor(props) {
    super(props);
    this.ro = new _resizeObserverPolyfill2.default(entries => {
      for (const entry of entries) {
        const { width } = entry.contentRect;
        const narrow = width < 600;
        if (this.isNarrow !== narrow) {
          this.isNarrow = narrow;
          this.update();
        }
      }
    });
    this.ro.observe(this.element);
  }

  render() {
    const panelBodyStyle = {
      padding: '10px'
    };

    let panelClass = 'go-plus-panel';
    if (this.isNarrow) {
      panelClass += ' is-narrow';
    }

    let tabs = [];
    let ActiveView;
    let activeModel;
    let packageName = 'unknown';
    const activeRef = this.props.model.activeItem + 'view';
    this.props.model.viewProviders.forEach(({ view, model }) => {
      if (this.props.model.activeItem === model.key) {
        ActiveView = view;
        activeModel = model;
        if (model && model.isActive) {
          model.isActive(true);
        }
      } else {
        if (model && model.isActive) {
          model.isActive(false);
        }
      }
      if (tabs.find(({ key }) => key === model.key)) {
        return;
      }
      tabs.push(Object.assign({
        key: model.key,
        order: 999,
        icon: 'question',
        packageName: 'unknown',
        name: ''
      }, model.tab));
    });
    if (!ActiveView || !activeModel) {
      ActiveView = _emptyTabView.EmptyTabView;
    }

    if (activeModel && activeModel.tab && activeModel.tab.suppressPadding) {
      panelBodyStyle.padding = '0px';
    }

    tabs = tabs.map(item => {
      item.className = 'panel-nav-item';
      if (this.props.model.activeItem === item.key) {
        item.className = item.className + ' is-selected';
      }
      return item;
    }).sort((a, b) => a.order - b.order || a.name.localeCompare(b.name));

    return _etch2.default.dom(
      'div',
      { ref: 'thepanel', className: panelClass },
      _etch2.default.dom(
        'div',
        { className: 'panel-heading' },
        _etch2.default.dom(
          'nav',
          { className: 'panel-group panel-nav' },
          tabs.map(item => {
            const tabKey = item.key + '-tab';
            return _etch2.default.dom(
              'span',
              {
                key: tabKey,
                className: item.className,
                on: { click: () => this.handleTabClick(item) }
              },
              _etch2.default.dom(_etchOcticon2.default, { name: item.icon }),
              _etch2.default.dom(
                'span',
                { className: 'panel-nav-label' },
                item.name
              )
            );
          })
        )
      ),
      _etch2.default.dom(
        'div',
        {
          ref: 'panelbody',
          className: 'go-plus-panel-body panel-body native-key-bindings',
          tabIndex: '0',
          style: panelBodyStyle
        },
        _etch2.default.dom(ActiveView, {
          ref: activeRef,
          model: activeModel,
          packageName: packageName
        })
      )
    );
  }

  readAfterUpdate() {
    const content = this.refs.content;
    if (!content) {
      return;
    }

    const scrollHeight = content.scrollHeight;
    if (scrollHeight && this.scrollHeight !== scrollHeight) {
      this.scrollHeight = scrollHeight;
      this.update();
    }
  }

  handleTabClick(item) {
    if (item && item.key && item.key.length && this.props.model.activeItem !== item.key) {
      this.props.model.activeItem = item.key;
      this.update();
    }
  }

  dispose() {
    this.destroy();
  }

  destroy() {
    this.ro.unobserve(this.element);
    this.ro = null;
    super.destroy(true);
  }
}

exports.GoPlusPanel = GoPlusPanel;
/** @jsx etch.dom */
/* eslint-disable react/no-unknown-property */
/* eslint-disable react/no-string-refs */

const PANEL_URI = exports.PANEL_URI = 'atom://go-plus/panel';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdvLXBsdXMtcGFuZWwuanMiXSwibmFtZXMiOlsiR29QbHVzUGFuZWwiLCJFdGNoQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInJvIiwiUmVzaXplT2JzZXJ2ZXIiLCJlbnRyaWVzIiwiZW50cnkiLCJ3aWR0aCIsImNvbnRlbnRSZWN0IiwibmFycm93IiwiaXNOYXJyb3ciLCJ1cGRhdGUiLCJvYnNlcnZlIiwiZWxlbWVudCIsInJlbmRlciIsInBhbmVsQm9keVN0eWxlIiwicGFkZGluZyIsInBhbmVsQ2xhc3MiLCJ0YWJzIiwiQWN0aXZlVmlldyIsImFjdGl2ZU1vZGVsIiwicGFja2FnZU5hbWUiLCJhY3RpdmVSZWYiLCJtb2RlbCIsImFjdGl2ZUl0ZW0iLCJ2aWV3UHJvdmlkZXJzIiwiZm9yRWFjaCIsInZpZXciLCJrZXkiLCJpc0FjdGl2ZSIsImZpbmQiLCJwdXNoIiwiT2JqZWN0IiwiYXNzaWduIiwib3JkZXIiLCJpY29uIiwibmFtZSIsInRhYiIsIkVtcHR5VGFiVmlldyIsInN1cHByZXNzUGFkZGluZyIsIm1hcCIsIml0ZW0iLCJjbGFzc05hbWUiLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwidGFiS2V5IiwiY2xpY2siLCJoYW5kbGVUYWJDbGljayIsInJlYWRBZnRlclVwZGF0ZSIsImNvbnRlbnQiLCJyZWZzIiwic2Nyb2xsSGVpZ2h0IiwibGVuZ3RoIiwiZGlzcG9zZSIsImRlc3Ryb3kiLCJ1bm9ic2VydmUiLCJQQU5FTF9VUkkiXSwibWFwcGluZ3MiOiI7Ozs7O0FBS0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFJTyxNQUFNQSxXQUFOLFNBQTBCQyw0QkFBMUIsQ0FBd0M7O0FBTTdDQyxjQUFZQyxLQUFaLEVBQTRDO0FBQzFDLFVBQU1BLEtBQU47QUFDQSxTQUFLQyxFQUFMLEdBQVUsSUFBSUMsZ0NBQUosQ0FBbUJDLFdBQVc7QUFDdEMsV0FBSyxNQUFNQyxLQUFYLElBQW9CRCxPQUFwQixFQUE2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R0FBbkM7QUFDQSxXQUFLakIsTUFBTDtBQUNEO0FBQ0Y7O0FBRUQ0QyxZQUFVO0FBQ1IsU0FBS0MsT0FBTDtBQUNEOztBQUVEQSxZQUFVO0FBQ1IsU0FBS3JELEVBQUwsQ0FBUXNELFNBQVIsQ0FBa0IsS0FBSzVDLE9BQXZCO0FBQ0EsU0FBS1YsRUFBTCxHQUFXLElBQVg7QUFDQSxVQUFNcUQsT0FBTixDQUFjLElBQWQ7QUFDRDtBQXRKNEM7O1FBQWxDekQsVyxHQUFBQSxXO0FBWmI7QUFDQTtBQUNBOztBQW1LTyxNQUFNMkQsZ0NBQVksc0JBQWxCIiwiZmlsZSI6ImdvLXBsdXMtcGFuZWwuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvbXl1Z2EvLmF0b20vcGFja2FnZXMvZ28tcGx1cy9saWIvcGFuZWwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuLyoqIEBqc3ggZXRjaC5kb20gKi9cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L25vLXVua25vd24tcHJvcGVydHkgKi9cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L25vLXN0cmluZy1yZWZzICovXG5cbmltcG9ydCBldGNoIGZyb20gJ2V0Y2gnXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJ1xuaW1wb3J0IHsgRXRjaENvbXBvbmVudCB9IGZyb20gJy4vLi4vZXRjaC1jb21wb25lbnQnXG5pbXBvcnQgeyBFbXB0eVRhYlZpZXcgfSBmcm9tICcuL2VtcHR5LXRhYi12aWV3J1xuaW1wb3J0IE9jdGljb24gZnJvbSAnZXRjaC1vY3RpY29uJ1xuaW1wb3J0IHR5cGUgeyBQYW5lbE1hbmFnZXIgfSBmcm9tICcuL3BhbmVsLW1hbmFnZXInXG5pbXBvcnQgdHlwZSB7IFRhYiB9IGZyb20gJy4vdGFiJ1xuXG5leHBvcnQgY2xhc3MgR29QbHVzUGFuZWwgZXh0ZW5kcyBFdGNoQ29tcG9uZW50IHtcbiAgcHJvcHM6IHsgbW9kZWw6IFBhbmVsTWFuYWdlciB9XG4gIHJvOiBSZXNpemVPYnNlcnZlclxuICBpc05hcnJvdzogYm9vbGVhblxuICBzY3JvbGxIZWlnaHQ6IG51bWJlclxuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiB7IG1vZGVsOiBQYW5lbE1hbmFnZXIgfSkge1xuICAgIHN1cGVyKHByb3BzKVxuICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoZW50cmllcyA9PiB7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgY29uc3QgeyB3aWR0aCB9ID0gZW50cnkuY29udGVudFJlY3RcbiAgICAgICAgY29uc3QgbmFycm93ID0gd2lkdGggPCA2MDBcbiAgICAgICAgaWYgKHRoaXMuaXNOYXJyb3cgIT09IG5hcnJvdykge1xuICAgICAgICAgIHRoaXMuaXNOYXJyb3cgPSBuYXJyb3dcbiAgICAgICAgICB0aGlzLnVwZGF0ZSgpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIHRoaXMucm8ub2JzZXJ2ZSh0aGlzLmVsZW1lbnQpXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgcGFuZWxCb2R5U3R5bGUgPSB7XG4gICAgICBwYWRkaW5nOiAnMTBweCdcbiAgICB9XG5cbiAgICBsZXQgcGFuZWxDbGFzcyA9ICdnby1wbHVzLXBhbmVsJ1xuICAgIGlmICh0aGlzLmlzTmFycm93KSB7XG4gICAgICBwYW5lbENsYXNzICs9ICcgaXMtbmFycm93J1xuICAgIH1cblxuICAgIGxldCB0YWJzOiBUYWJbXSA9IFtdXG4gICAgbGV0IEFjdGl2ZVZpZXdcbiAgICBsZXQgYWN0aXZlTW9kZWxcbiAgICBsZXQgcGFja2FnZU5hbWUgPSAndW5rbm93bidcbiAgICBjb25zdCBhY3RpdmVSZWYgPSB0aGlzLnByb3BzLm1vZGVsLmFjdGl2ZUl0ZW0gKyAndmlldydcbiAgICB0aGlzLnByb3BzLm1vZGVsLnZpZXdQcm92aWRlcnMuZm9yRWFjaCgoeyB2aWV3LCBtb2RlbCB9KSA9PiB7XG4gICAgICBpZiAodGhpcy5wcm9wcy5tb2RlbC5hY3RpdmVJdGVtID09PSBtb2RlbC5rZXkpIHtcbiAgICAgICAgQWN0aXZlVmlldyA9IHZpZXdcbiAgICAgICAgYWN0aXZlTW9kZWwgPSBtb2RlbFxuICAgICAgICBpZiAobW9kZWwgJiYgbW9kZWwuaXNBY3RpdmUpIHtcbiAgICAgICAgICBtb2RlbC5pc0FjdGl2ZSh0cnVlKVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAobW9kZWwgJiYgbW9kZWwuaXNBY3RpdmUpIHtcbiAgICAgICAgICBtb2RlbC5pc0FjdGl2ZShmYWxzZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRhYnMuZmluZCgoeyBrZXkgfSkgPT4ga2V5ID09PSBtb2RlbC5rZXkpKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgdGFicy5wdXNoKFxuICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgICh7XG4gICAgICAgICAgICBrZXk6IG1vZGVsLmtleSxcbiAgICAgICAgICAgIG9yZGVyOiA5OTksXG4gICAgICAgICAgICBpY29uOiAncXVlc3Rpb24nLFxuICAgICAgICAgICAgcGFja2FnZU5hbWU6ICd1bmtub3duJyxcbiAgICAgICAgICAgIG5hbWU6ICcnXG4gICAgICAgICAgfTogVGFiKSxcbiAgICAgICAgICBtb2RlbC50YWJcbiAgICAgICAgKVxuICAgICAgKVxuICAgIH0pXG4gICAgaWYgKCFBY3RpdmVWaWV3IHx8ICFhY3RpdmVNb2RlbCkge1xuICAgICAgQWN0aXZlVmlldyA9IEVtcHR5VGFiVmlld1xuICAgIH1cblxuICAgIGlmIChhY3RpdmVNb2RlbCAmJiBhY3RpdmVNb2RlbC50YWIgJiYgYWN0aXZlTW9kZWwudGFiLnN1cHByZXNzUGFkZGluZykge1xuICAgICAgcGFuZWxCb2R5U3R5bGUucGFkZGluZyA9ICcwcHgnXG4gICAgfVxuXG4gICAgdGFicyA9IHRhYnNcbiAgICAgIC5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gJ3BhbmVsLW5hdi1pdGVtJ1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5tb2RlbC5hY3RpdmVJdGVtID09PSBpdGVtLmtleSkge1xuICAgICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gaXRlbS5jbGFzc05hbWUgKyAnIGlzLXNlbGVjdGVkJ1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtXG4gICAgICB9KVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyIHx8IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiByZWY9XCJ0aGVwYW5lbFwiIGNsYXNzTmFtZT17cGFuZWxDbGFzc30+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicGFuZWwtaGVhZGluZ1wiPlxuICAgICAgICAgIDxuYXYgY2xhc3NOYW1lPVwicGFuZWwtZ3JvdXAgcGFuZWwtbmF2XCI+XG4gICAgICAgICAgICB7dGFicy5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHRhYktleSA9IGl0ZW0ua2V5ICsgJy10YWInXG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgIGtleT17dGFiS2V5fVxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtpdGVtLmNsYXNzTmFtZX1cbiAgICAgICAgICAgICAgICAgIG9uPXt7IGNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVRhYkNsaWNrKGl0ZW0pIH19XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPE9jdGljb24gbmFtZT17aXRlbS5pY29ufSAvPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwicGFuZWwtbmF2LWxhYmVsXCI+e2l0ZW0ubmFtZX08L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA8L25hdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICByZWY9XCJwYW5lbGJvZHlcIlxuICAgICAgICAgIGNsYXNzTmFtZT1cImdvLXBsdXMtcGFuZWwtYm9keSBwYW5lbC1ib2R5IG5hdGl2ZS1rZXktYmluZGluZ3NcIlxuICAgICAgICAgIHRhYkluZGV4PVwiMFwiXG4gICAgICAgICAgc3R5bGU9e3BhbmVsQm9keVN0eWxlfVxuICAgICAgICA+XG4gICAgICAgICAgPEFjdGl2ZVZpZXdcbiAgICAgICAgICAgIHJlZj17YWN0aXZlUmVmfVxuICAgICAgICAgICAgbW9kZWw9e2FjdGl2ZU1vZGVsfVxuICAgICAgICAgICAgcGFja2FnZU5hbWU9e3BhY2thZ2VOYW1lfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG5cbiAgcmVhZEFmdGVyVXBkYXRlKCkge1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLnJlZnMuY29udGVudFxuICAgIGlmICghY29udGVudCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gY29udGVudC5zY3JvbGxIZWlnaHRcbiAgICBpZiAoc2Nyb2xsSGVpZ2h0ICYmIHRoaXMuc2Nyb2xsSGVpZ2h0ICE9PSBzY3JvbGxIZWlnaHQpIHtcbiAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gc2Nyb2xsSGVpZ2h0XG4gICAgICB0aGlzLnVwZGF0ZSgpXG4gICAgfVxuICB9XG5cbiAgaGFuZGxlVGFiQ2xpY2soaXRlbTogVGFiKSB7XG4gICAgaWYgKFxuICAgICAgaXRlbSAmJlxuICAgICAgaXRlbS5rZXkgJiZcbiAgICAgIGl0ZW0ua2V5Lmxlbmd0aCAmJlxuICAgICAgdGhpcy5wcm9wcy5tb2RlbC5hY3RpdmVJdGVtICE9PSBpdGVtLmtleVxuICAgICkge1xuICAgICAgdGhpcy5wcm9wcy5tb2RlbC5hY3RpdmVJdGVtID0gaXRlbS5rZXlcbiAgICAgIHRoaXMudXBkYXRlKClcbiAgICB9XG4gIH1cblxuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuZGVzdHJveSgpXG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMucm8udW5vYnNlcnZlKHRoaXMuZWxlbWVudClcbiAgICB0aGlzLnJvID0gKG51bGw6IGFueSlcbiAgICBzdXBlci5kZXN0cm95KHRydWUpXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFBBTkVMX1VSSSA9ICdhdG9tOi8vZ28tcGx1cy9wYW5lbCdcbiJdfQ==