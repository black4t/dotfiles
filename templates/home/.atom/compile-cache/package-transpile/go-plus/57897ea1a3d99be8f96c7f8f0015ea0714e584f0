Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PanelManager = undefined;

var _atom = require('atom');

var _goPlusPanel = require('./go-plus-panel');

class PanelManager {

  constructor() {
    this.activeItem = 'go';

    this.item = {
      getURI: () => _goPlusPanel.PANEL_URI,
      getTitle: () => 'go-plus',
      getIconName: () => 'diff-added',
      getDefaultLocation: () => 'bottom',
      getAllowedLocations: () => ['right', 'left', 'bottom']
    };

    this.subscriptions = new _atom.CompositeDisposable();
    this.viewProviders = new Map();

    this.subscribeToCommands();
  }

  createPanel(visible) {
    if (this.goPlusPanel) {
      this.goPlusPanel.destroy();
    }
    this.goPlusPanel = new _goPlusPanel.GoPlusPanel({ model: this });
    this.item.element = this.goPlusPanel.element;
    //$FlowFixMe
    return atom.workspace.open(this.item, {
      activatePane: visible
    }).then(() => this.requestUpdate());
  }

  requestUpdate() {
    if (this.goPlusPanel) {
      return this.goPlusPanel.update();
    } else {
      return this.createPanel(atom.config.get('go-plus.panel.displayMode') === 'open');
    }
  }

  subscribeToCommands() {
    if (!this.subscriptions) {
      return;
    }
    this.subscriptions.add(atom.commands.add('atom-workspace', 'golang:toggle-panel', () => {
      this.togglePanel();
    }));
  }

  dispose() {
    if (this.subscriptions) {
      this.subscriptions.dispose();
    }

    const pane = atom.workspace.paneForURI(_goPlusPanel.PANEL_URI);
    if (pane) {
      pane.destroyItem(this.item);
    }

    if (this.goPlusPanel) {
      this.goPlusPanel.destroy();
    }
    this.goPlusPanel = null;
    this.viewProviders.clear();
  }

  registerViewProvider(view, model) {
    if (!view || !model || !model.key) {
      return new _atom.Disposable();
    }
    const key = model.key;
    model.requestFocus = () => {
      this.activeItem = key;
      return this.togglePanel(true);
    };
    this.viewProviders.set(key, { view, model });
    if (this.goPlusPanel) {
      this.goPlusPanel.update();
    }

    return new _atom.Disposable(() => {
      if (this.viewProviders && this.viewProviders.has(key)) {
        this.viewProviders.delete(key);
      }
    });
  }

  togglePanel(visible) {
    //$FlowFixMe
    const container = atom.workspace.paneContainerForURI(_goPlusPanel.PANEL_URI);
    if (!container) {
      return this.createPanel(true);
    }

    const pane = atom.workspace.paneForURI(_goPlusPanel.PANEL_URI);
    if (visible === undefined) {
      const currentlyVisible = container.isVisible() && pane && pane.getActiveItem() === this.item;
      visible = !currentlyVisible;
    }

    if (!visible) {
      container.hide();
      for (const _ref of this.viewProviders.values()) {
        const { model } = _ref;

        if (model.isActive) {
          model.isActive(false);
        }
      }
      return Promise.resolve();
    }
    container.show();
    //$FlowFixMe
    pane.activateItemForURI(_goPlusPanel.PANEL_URI);

    if (this.goPlusPanel) {
      return this.goPlusPanel.update();
    } else {
      return Promise.resolve();
    }
  }
}

exports.PanelManager = PanelManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhbmVsLW1hbmFnZXIuanMiXSwibmFtZXMiOlsiUGFuZWxNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJhY3RpdmVJdGVtIiwiaXRlbSIsImdldFVSSSIsIlBBTkVMX1VSSSIsImdldFRpdGxlIiwiZ2V0SWNvbk5hbWUiLCJnZXREZWZhdWx0TG9jYXRpb24iLCJnZXRBbGxvd2VkTG9jYXRpb25zIiwic3Vic2NyaXB0aW9ucyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJ2aWV3UHJvdmlkZXJzIiwiTWFwIiwic3Vic2NyaWJlVG9Db21tYW5kcyIsImNyZWF0ZVBhbmVsIiwidmlzaWJsZSIsImdvUGx1c1BhbmVsIiwiZGVzdHJveSIsIkdvUGx1c1BhbmVsIiwibW9kZWwiLCJlbGVtZW50IiwiYXRvbSIsIndvcmtzcGFjZSIsIm9wZW4iLCJhY3RpdmF0ZVBhbmUiLCJ0aGVuIiwicmVxdWVzdFVwZGF0ZSIsInVwZGF0ZSIsImNvbmZpZyIsImdldCIsImFkZCIsImNvbW1hbmRzIiwidG9nZ2xlUGFuZWwiLCJkaXNwb3NlIiwicGFuZSIsInBhbmVGb3JVUkkiLCJkZXN0cm95SXRlbSIsImNsZWFyIiwicmVnaXN0ZXJWaWV3UHJvdmlkZXIiLCJ2aWV3Iiwia2V5IiwiRGlzcG9zYWJsZSIsInJlcXVlc3RGb2N1cyIsInNldCIsImhhcyIsImRlbGV0ZSIsImNvbnRhaW5lciIsInBhbmVDb250YWluZXJGb3JVUkkiLCJ1bmRlZmluZWQiLCJjdXJyZW50bHlWaXNpYmxlIiwiaXNWaXNpYmxlIiwiZ2V0QWN0aXZlSXRlbSIsImhpZGUiLCJ2YWx1ZXMiLCJpc0FjdGl2ZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2hvdyIsImFjdGl2YXRlSXRlbUZvclVSSSJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQTs7QUFDQTs7QUFNQSxNQUFNQSxZQUFOLENBQW1COztBQWVqQkMsZ0JBQWM7QUFDWixTQUFLQyxVQUFMLEdBQWtCLElBQWxCOztBQUVBLFNBQUtDLElBQUwsR0FBWTtBQUNWQyxj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R0FBQUEsWSIsImZpbGUiOiJwYW5lbC1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLXBsdXMvbGliL3BhbmVsIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcblxuaW1wb3J0IHsgQ29tcG9zaXRlRGlzcG9zYWJsZSwgRGlzcG9zYWJsZSB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBHb1BsdXNQYW5lbCwgUEFORUxfVVJJIH0gZnJvbSAnLi9nby1wbHVzLXBhbmVsJ1xuXG5pbXBvcnQgdHlwZSB7IFBhbmVsTW9kZWwgfSBmcm9tICcuL3RhYidcbmltcG9ydCB0eXBlIHsgR29Db25maWcgfSBmcm9tICcuLy4uL2NvbmZpZy9zZXJ2aWNlJ1xuaW1wb3J0IHR5cGUgeyBSZW5kZXJhYmxlIH0gZnJvbSAnLi4vZXRjaC1jb21wb25lbnQnXG5cbmNsYXNzIFBhbmVsTWFuYWdlciB7XG4gIGFjdGl2ZUl0ZW06IHN0cmluZ1xuICBpdGVtOiB7XG4gICAgZWxlbWVudD86IGFueSxcbiAgICBnZXRVUkk6ICgpID0+IHN0cmluZyxcbiAgICBnZXRUaXRsZTogKCkgPT4gc3RyaW5nLFxuICAgIGdldEljb25OYW1lOiAoKSA9PiBzdHJpbmcsXG4gICAgZ2V0RGVmYXVsdExvY2F0aW9uOiAoKSA9PiBzdHJpbmcsXG4gICAgZ2V0QWxsb3dlZExvY2F0aW9uczogKCkgPT4gc3RyaW5nW11cbiAgfVxuICBzdWJzY3JpcHRpb25zOiBDb21wb3NpdGVEaXNwb3NhYmxlXG4gIHZpZXdQcm92aWRlcnM6IE1hcDxzdHJpbmcsIHsgdmlldzogQ2xhc3M8UmVuZGVyYWJsZT4sIG1vZGVsOiBQYW5lbE1vZGVsIH0+XG4gIGdvUGx1c1BhbmVsOiA/R29QbHVzUGFuZWxcbiAgZ29jb25maWc6IEdvQ29uZmlnXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hY3RpdmVJdGVtID0gJ2dvJ1xuXG4gICAgdGhpcy5pdGVtID0ge1xuICAgICAgZ2V0VVJJOiAoKSA9PiBQQU5FTF9VUkksXG4gICAgICBnZXRUaXRsZTogKCkgPT4gJ2dvLXBsdXMnLFxuICAgICAgZ2V0SWNvbk5hbWU6ICgpID0+ICdkaWZmLWFkZGVkJyxcbiAgICAgIGdldERlZmF1bHRMb2NhdGlvbjogKCkgPT4gJ2JvdHRvbScsXG4gICAgICBnZXRBbGxvd2VkTG9jYXRpb25zOiAoKSA9PiBbJ3JpZ2h0JywgJ2xlZnQnLCAnYm90dG9tJ11cbiAgICB9XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG4gICAgdGhpcy52aWV3UHJvdmlkZXJzID0gbmV3IE1hcCgpXG5cbiAgICB0aGlzLnN1YnNjcmliZVRvQ29tbWFuZHMoKVxuICB9XG5cbiAgY3JlYXRlUGFuZWwodmlzaWJsZTogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmdvUGx1c1BhbmVsKSB7XG4gICAgICB0aGlzLmdvUGx1c1BhbmVsLmRlc3Ryb3koKVxuICAgIH1cbiAgICB0aGlzLmdvUGx1c1BhbmVsID0gbmV3IEdvUGx1c1BhbmVsKHsgbW9kZWw6IHRoaXMgfSlcbiAgICB0aGlzLml0ZW0uZWxlbWVudCA9IHRoaXMuZ29QbHVzUGFuZWwuZWxlbWVudFxuICAgIC8vJEZsb3dGaXhNZVxuICAgIHJldHVybiBhdG9tLndvcmtzcGFjZVxuICAgICAgLm9wZW4odGhpcy5pdGVtLCB7XG4gICAgICAgIGFjdGl2YXRlUGFuZTogdmlzaWJsZVxuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHRoaXMucmVxdWVzdFVwZGF0ZSgpKVxuICB9XG5cbiAgcmVxdWVzdFVwZGF0ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5nb1BsdXNQYW5lbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ29QbHVzUGFuZWwudXBkYXRlKClcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlUGFuZWwoXG4gICAgICAgIGF0b20uY29uZmlnLmdldCgnZ28tcGx1cy5wYW5lbC5kaXNwbGF5TW9kZScpID09PSAnb3BlbidcbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBzdWJzY3JpYmVUb0NvbW1hbmRzKCkge1xuICAgIGlmICghdGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdnb2xhbmc6dG9nZ2xlLXBhbmVsJywgKCkgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZVBhbmVsKClcbiAgICAgIH0pXG4gICAgKVxuICB9XG5cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpXG4gICAgfVxuXG4gICAgY29uc3QgcGFuZSA9IGF0b20ud29ya3NwYWNlLnBhbmVGb3JVUkkoUEFORUxfVVJJKVxuICAgIGlmIChwYW5lKSB7XG4gICAgICBwYW5lLmRlc3Ryb3lJdGVtKHRoaXMuaXRlbSlcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nb1BsdXNQYW5lbCkge1xuICAgICAgdGhpcy5nb1BsdXNQYW5lbC5kZXN0cm95KClcbiAgICB9XG4gICAgdGhpcy5nb1BsdXNQYW5lbCA9IG51bGxcbiAgICB0aGlzLnZpZXdQcm92aWRlcnMuY2xlYXIoKVxuICB9XG5cbiAgcmVnaXN0ZXJWaWV3UHJvdmlkZXIodmlldzogQ2xhc3M8UmVuZGVyYWJsZT4sIG1vZGVsOiBQYW5lbE1vZGVsKTogRGlzcG9zYWJsZSB7XG4gICAgaWYgKCF2aWV3IHx8ICFtb2RlbCB8fCAhbW9kZWwua2V5KSB7XG4gICAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKVxuICAgIH1cbiAgICBjb25zdCBrZXkgPSBtb2RlbC5rZXlcbiAgICBtb2RlbC5yZXF1ZXN0Rm9jdXMgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBrZXlcbiAgICAgIHJldHVybiB0aGlzLnRvZ2dsZVBhbmVsKHRydWUpXG4gICAgfVxuICAgIHRoaXMudmlld1Byb3ZpZGVycy5zZXQoa2V5LCB7IHZpZXcsIG1vZGVsIH0pXG4gICAgaWYgKHRoaXMuZ29QbHVzUGFuZWwpIHtcbiAgICAgIHRoaXMuZ29QbHVzUGFuZWwudXBkYXRlKClcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMudmlld1Byb3ZpZGVycyAmJiB0aGlzLnZpZXdQcm92aWRlcnMuaGFzKGtleSkpIHtcbiAgICAgICAgdGhpcy52aWV3UHJvdmlkZXJzLmRlbGV0ZShrZXkpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHRvZ2dsZVBhbmVsKHZpc2libGU/OiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8kRmxvd0ZpeE1lXG4gICAgY29uc3QgY29udGFpbmVyID0gYXRvbS53b3Jrc3BhY2UucGFuZUNvbnRhaW5lckZvclVSSShQQU5FTF9VUkkpXG4gICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVBhbmVsKHRydWUpXG4gICAgfVxuXG4gICAgY29uc3QgcGFuZSA9IGF0b20ud29ya3NwYWNlLnBhbmVGb3JVUkkoUEFORUxfVVJJKVxuICAgIGlmICh2aXNpYmxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRseVZpc2libGUgPVxuICAgICAgICBjb250YWluZXIuaXNWaXNpYmxlKCkgJiYgcGFuZSAmJiBwYW5lLmdldEFjdGl2ZUl0ZW0oKSA9PT0gdGhpcy5pdGVtXG4gICAgICB2aXNpYmxlID0gIWN1cnJlbnRseVZpc2libGVcbiAgICB9XG5cbiAgICBpZiAoIXZpc2libGUpIHtcbiAgICAgIGNvbnRhaW5lci5oaWRlKClcbiAgICAgIGZvciAoY29uc3QgeyBtb2RlbCB9IG9mIHRoaXMudmlld1Byb3ZpZGVycy52YWx1ZXMoKSkge1xuICAgICAgICBpZiAobW9kZWwuaXNBY3RpdmUpIHtcbiAgICAgICAgICBtb2RlbC5pc0FjdGl2ZShmYWxzZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG4gICAgfVxuICAgIGNvbnRhaW5lci5zaG93KClcbiAgICAvLyRGbG93Rml4TWVcbiAgICBwYW5lLmFjdGl2YXRlSXRlbUZvclVSSShQQU5FTF9VUkkpXG5cbiAgICBpZiAodGhpcy5nb1BsdXNQYW5lbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ29QbHVzUGFuZWwudXBkYXRlKClcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IFBhbmVsTWFuYWdlciB9XG4iXX0=