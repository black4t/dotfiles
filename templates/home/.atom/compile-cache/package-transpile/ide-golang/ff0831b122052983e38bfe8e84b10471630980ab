"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const commons_1 = require("./commons");
const utils = require("./utils");
class GoImports {
    constructor(core) {
        this.core = core;
    }
    formatFile(editor, _) {
        return new Promise((resolve) => {
            const filePath = editor.getPath();
            this.core.spawn("goimports", ["-e", "-srcdir=" + filePath], {
                cwd: utils.getDirname(editor),
                input: editor.getText(),
            }).then((out) => {
                this.core.clearMessages();
                resolve({
                    formatted: out,
                });
            }).catch((err) => {
                if (err instanceof commons_1.ExecError) {
                    const [parsed, unparsed] = utils.parseLintErrors(err.message);
                    this.core.setAllMessages(parsed);
                    unparsed.map(this.core.logWarn.bind(this));
                }
                else {
                    this.core.logWarn(err);
                }
                resolve({
                    formatted: editor.getText(),
                });
            });
        });
    }
}
exports.GoImports = GoImports;
