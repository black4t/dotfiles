"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils = require("./utils");
class Guru {
    constructor(core) {
        this.core = core;
    }
    getDefinition(editor, point) {
        const m = this.core.reportBusy("Go to definitions...");
        return new Promise((resolve, _) => {
            const offset = editor.getBuffer().characterIndexForPosition(point);
            this.core.spawn("guru", ["-json", "-modified", "definition", editor.getPath() + ":#" + offset], {
                cwd: utils.getDirname(editor),
                input: utils.getFileArchive(editor),
            }).then((out) => {
                const output = JSON.parse(out.toString());
                m.dispose();
                resolve(utils.jsonToDefinitionQueryResult(output));
            }).catch((err) => {
                this.core.logTrace(err);
                m.dispose();
                resolve(null);
            });
        });
    }
    getReferences(editor, point) {
        return new Promise((resolve, _) => {
            const offset = editor.getBuffer().characterIndexForPosition(point);
            this.core.spawn("guru", ["-modified", "referrers", editor.getPath() + ":#" + offset], {
                cwd: utils.getDirname(editor),
                input: utils.getFileArchive(editor),
            }).then((out) => {
                resolve(utils.guruReferrersToAtomReferences(editor, out));
            }).catch((err) => {
                this.core.logWarn(err);
                resolve(err);
            });
        });
    }
}
exports.Guru = Guru;
