(function() {
  var HEADING_REGEX, JumpTo, REFERENCE_REGEX, TABLE_COL_REGEX, utils;

  utils = require("../utils");

  HEADING_REGEX = /^\#{1,6} +.+$/;

  REFERENCE_REGEX = /\[([^\[\]]+)(?:\]|\]:)/;

  TABLE_COL_REGEX = /([^\|]*?)\s*\|/;

  module.exports = JumpTo = (function() {
    function JumpTo(command) {
      this.command = command;
      this.editor = atom.workspace.getActiveTextEditor();
      this.cursor = this.editor.getCursorBufferPosition();
    }

    JumpTo.prototype.trigger = function(e) {
      var fn, range;
      fn = this.command.replace(/-[a-z]/ig, function(s) {
        return s[1].toUpperCase();
      });
      range = this[fn]();
      if (range) {
        return this.editor.setCursorBufferPosition(range);
      } else {
        return e.abortKeyBinding();
      }
    };

    JumpTo.prototype.previousHeading = function() {
      var range;
      range = [[0, 0], [this.cursor.row - 1, 0]];
      return this._findNextHeading(range, "backwardsScanInRange");
    };

    JumpTo.prototype.nextHeading = function() {
      var eof, range;
      eof = this.editor.getEofBufferPosition();
      range = this._findNextHeading([[this.cursor.row + 1, 0], [eof.row + 1, 0]]);
      if (range) {
        return range;
      }
      return this._findNextHeading([[0, 0], [eof.row + 1, 0]]);
    };

    JumpTo.prototype._findNextHeading = function(range, scan) {
      var found;
      if (scan == null) {
        scan = "scanInRange";
      }
      found = false;
      this.editor.buffer[scan](RegExp("" + HEADING_REGEX.source, "g"), range, (function(_this) {
        return function(match) {
          var descriptors;
          descriptors = _this.editor.scopeDescriptorForBufferPosition(match.range.start).getScopesArray();
          if (descriptors.find(function(descriptor) {
            return descriptor.indexOf("heading") >= 0;
          })) {
            found = match.range.start;
            return match.stop();
          }
        };
      })(this));
      return found;
    };

    JumpTo.prototype.referenceDefinition = function() {
      var found, link, range, selection;
      range = utils.getTextBufferRange(this.editor, "link", {
        selectBy: "currentLine"
      });
      if (link = utils.findLinkInRange(this.editor, range)) {
        if (!link.id) {
          return false;
        }
        if (!link.linkRange || !link.definitionRange) {
          return false;
        }
        if (link.linkRange.start.row !== this.cursor.row && link.linkRange.end.row !== this.cursor.row) {
          return [link.linkRange.start.row, link.linkRange.start.column];
        } else {
          return [link.definitionRange.start.row, link.definitionRange.start.column];
        }
      } else {
        selection = this.editor.getTextInRange(range);
        if (!selection) {
          return false;
        }
        link = REFERENCE_REGEX.exec(selection);
        if (!link) {
          return false;
        }
        found = false;
        this.editor.buffer.scan(RegExp("\\[" + (utils.escapeRegExp(link[1])) + "\\]", "g"), (function(_this) {
          return function(match) {
            if (match.range.start.row !== _this.cursor.row && match.range.end.row !== _this.cursor.row) {
              found = [match.range.start.row, match.range.start.column];
              return match.stop();
            }
          };
        })(this));
        return found;
      }
    };

    JumpTo.prototype.nextTableCell = function() {
      var line;
      line = this.editor.lineTextForBufferRow(this.cursor.row);
      if (utils.isTableRow(line) || utils.isTableSeparator(line)) {
        return this._findNextTableCell(line, this.cursor.row, this.cursor.column);
      } else {
        return false;
      }
    };

    JumpTo.prototype._findNextTableCell = function(currentLine, row, column) {
      var td;
      column = currentLine.indexOf("|", column);
      if (column === -1 || column === currentLine.length - 1) {
        row += 1;
        column = 0;
        currentLine = this.editor.lineTextForBufferRow(row);
      }
      if (utils.isTableSeparator(currentLine)) {
        row += 1;
        column = 0;
        currentLine = this.editor.lineTextForBufferRow(row);
      }
      if (currentLine === void 0) {
        return false;
      }
      if (currentLine[column] === "|") {
        column += 1;
        currentLine = currentLine.slice(column);
      }
      if (td = TABLE_COL_REGEX.exec(currentLine)) {
        return [row, column + td[1].length];
      } else {
        return [row, column + currentLine.length];
      }
    };

    return JumpTo;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvbXl1Z2EvLmF0b20vcGFja2FnZXMvbWFya2Rvd24td3JpdGVyL2xpYi9jb21tYW5kcy9qdW1wLXRvLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7O0VBQUEsS0FBQSxHQUFRLE9BQUEsQ0FBUSxVQUFSOztFQUVSLGFBQUEsR0FBa0I7O0VBQ2xCLGVBQUEsR0FBa0I7O0VBQ2xCLGVBQUEsR0FBa0I7O0VBRWxCLE1BQU0sQ0FBQyxPQUFQLEdBQ007SUFDUyxnQkFBQyxPQUFEO01BQ1gsSUFBQyxDQUFBLE9BQUQsR0FBVztNQUNYLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBZixDQUFBO01BQ1YsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFDLENBQUEsTUFBTSxDQUFDLHVCQUFSLENBQUE7SUFIQzs7cUJBS2IsT0FBQSxHQUFTLFNBQUMsQ0FBRDtBQUNQLFVBQUE7TUFBQSxFQUFBLEdBQUssSUFBQyxDQUFBLE9BQU8sQ0FBQyxPQUFULENBQWlCLFVBQWpCLEVBQTZCLFNBQUMsQ0FBRDtlQUFPLENBQUUsQ0FBQSxDQUFBLENBQUUsQ0FBQyxXQUFMLENBQUE7TUFBUCxDQUE3QjtNQUNMLEtBQUEsR0FBUSxJQUFFLENBQUEsRUFBQSxDQUFGLENBQUE7TUFFUixJQUFHLEtBQUg7ZUFDRSxJQUFDLENBQUEsTUFBTSxDQUFDLHVCQUFSLENBQWdDLEtBQWhDLEVBREY7T0FBQSxNQUFBO2VBR0UsQ0FBQyxDQUFDLGVBQUYsQ0FBQSxFQUhGOztJQUpPOztxQkFTVCxlQUFBLEdBQWlCLFNBQUE7QUFDZixVQUFBO01BQUEsS0FBQSxHQUFRLENBQUMsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFELEVBQVMsQ0FBQyxJQUFDLENBQUEsTUFBTSxDQUFDLEdBQVIsR0FBYyxDQUFmLEVBQWtCLENBQWxCLENBQVQ7QUFDUixhQUFPLElBQUMsQ0FBQSxnQkFB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REY7T0FBQSxNQUFBO2VBR0UsTUFIRjs7SUFIYTs7cUJBUWYsa0JBQUEsR0FBb0IsU0FBQyxXQUFELEVBQWMsR0FBZCxFQUFtQixNQUFuQjtBQUVsQixVQUFBO01BQUEsTUFBQSxHQUFTLFdBQVcsQ0FBQyxPQUFaLENBQW9CLEdBQXBCLEVBQXlCLE1BQXpCO01BR1QsSUFBRyxNQUFBLEtBQVUsQ0FBQyxDQUFYLElBQWdCLE1BQUEsS0FBVSxXQUFXLENBQUMsTUFBWixHQUFxQixDQUFsRDtRQUNFLEdBQUEsSUFBTztRQUNQLE1BQUEsR0FBUztRQUNULFdBQUEsR0FBYyxJQUFDLENBQUEsTUFBTSxDQUFDLG9CQUFSLENBQTZCLEdBQTdCLEVBSGhCOztNQU1BLElBQUcsS0FBSyxDQUFDLGdCQUFOLENBQXVCLFdBQXZCLENBQUg7UUFDRSxHQUFBLElBQU87UUFDUCxNQUFBLEdBQVM7UUFDVCxXQUFBLEdBQWMsSUFBQyxDQUFBLE1BQU0sQ0FBQyxvQkFBUixDQUE2QixHQUE3QixFQUhoQjs7TUFNQSxJQUFnQixXQUFBLEtBQWUsTUFBL0I7QUFBQSxlQUFPLE1BQVA7O01BR0EsSUFBRyxXQUFZLENBQUEsTUFBQSxDQUFaLEtBQXVCLEdBQTFCO1FBQ0UsTUFBQSxJQUFVO1FBQ1YsV0FBQSxHQUFjLFdBQVksZUFGNUI7O01BS0EsSUFBRyxFQUFBLEdBQUssZUFBZSxDQUFDLElBQWhCLENBQXFCLFdBQXJCLENBQVI7ZUFDRSxDQUFDLEdBQUQsRUFBTSxNQUFBLEdBQVMsRUFBRyxDQUFBLENBQUEsQ0FBRSxDQUFDLE1BQXJCLEVBREY7T0FBQSxNQUFBO2VBR0UsQ0FBQyxHQUFELEVBQU0sTUFBQSxHQUFTLFdBQVcsQ0FBQyxNQUEzQixFQUhGOztJQXpCa0I7Ozs7O0FBOUV0QiIsInNvdXJjZXNDb250ZW50IjpbInV0aWxzID0gcmVxdWlyZSBcIi4uL3V0aWxzXCJcblxuSEVBRElOR19SRUdFWCAgID0gLy8vIF5cXCN7MSw2fSBcXCArIC4rJCAvLy9cblJFRkVSRU5DRV9SRUdFWCA9IC8vLyBcXFsgKFteXFxbXFxdXSspICg/OlxcXXxcXF06KSAvLy9cblRBQkxFX0NPTF9SRUdFWCA9IC8vLyAoW15cXHxdKj8pIFxccyogXFx8IC8vL1xuXG5tb2R1bGUuZXhwb3J0cyA9XG5jbGFzcyBKdW1wVG9cbiAgY29uc3RydWN0b3I6IChjb21tYW5kKSAtPlxuICAgIEBjb21tYW5kID0gY29tbWFuZFxuICAgIEBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgICBAY3Vyc29yID0gQGVkaXRvci5nZXRDdXJzb3JCdWZmZXJQb3NpdGlvbigpXG5cbiAgdHJpZ2dlcjogKGUpIC0+XG4gICAgZm4gPSBAY29tbWFuZC5yZXBsYWNlKC8tW2Etel0vaWcsIChzKSAtPiBzWzFdLnRvVXBwZXJDYXNlKCkpXG4gICAgcmFuZ2UgPSBAW2ZuXSgpXG5cbiAgICBpZiByYW5nZVxuICAgICAgQGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihyYW5nZSlcbiAgICBlbHNlXG4gICAgICBlLmFib3J0S2V5QmluZGluZygpXG5cbiAgcHJldmlvdXNIZWFkaW5nOiAtPlxuICAgIHJhbmdlID0gW1swLCAwXSwgW0BjdXJzb3Iucm93IC0gMSwgMF1dXG4gICAgcmV0dXJuIEBfZmluZE5leHRIZWFkaW5nKHJhbmdlLCBcImJhY2t3YXJkc1NjYW5JblJhbmdlXCIpXG5cbiAgbmV4dEhlYWRpbmc6IC0+XG4gICAgZW9mID0gQGVkaXRvci5nZXRFb2ZCdWZmZXJQb3NpdGlvbigpXG4gICAgIyBmaW5kIHRvIGVuZCBvZiBmaWxlXG4gICAgcmFuZ2UgPSBAX2ZpbmROZXh0SGVhZGluZyhbW0BjdXJzb3Iucm93ICsgMSwgMF0sIFtlb2Yucm93ICsgMSwgMF1dKVxuICAgIHJldHVybiByYW5nZSBpZiByYW5nZVxuICAgICMgZmluZCBhcm91bmQgdGhlIHRvcCBvZiBmaWxlXG4gICAgcmV0dXJuIEBfZmluZE5leHRIZWFkaW5nKFtbMCwgMF0sIFtlb2Yucm93ICsgMSwgMF1dKVxuXG4gIF9maW5kTmV4dEhlYWRpbmc6IChyYW5nZSwgc2NhbiA9IFwic2NhbkluUmFuZ2VcIikgLT5cbiAgICBmb3VuZCA9IGZhbHNlXG4gICAgQGVkaXRvci5idWZmZXJbc2Nhbl0gLy8vICN7SEVBRElOR19SRUdFWC5zb3VyY2V9IC8vL2csIHJhbmdlLCAobWF0Y2gpID0+XG4gICAgICBkZXNjcmlwdG9ycyA9IEBlZGl0b3Iuc2NvcGVEZXNjcmlwdG9yRm9yQnVmZmVyUG9zaXRpb24obWF0Y2gucmFuZ2Uuc3RhcnQpLmdldFNjb3Blc0FycmF5KClcbiAgICAgICMgZXhjbHVkZSBoZWFkaW5ncyBpbiBjb21tZW50cy9jb2RlIGJsb2Nrc1xuICAgICAgaWYgZGVzY3JpcHRvcnMuZmluZCgoZGVzY3JpcHRvcikgLT4gZGVzY3JpcHRvci5pbmRleE9mKFwiaGVhZGluZ1wiKSA+PSAwKVxuICAgICAgICBmb3VuZCA9IG1hdGNoLnJhbmdlLnN0YXJ0XG4gICAgICAgIG1hdGNoLnN0b3AoKVxuICAgIHJldHVybiBmb3VuZFxuXG4gIHJlZmVyZW5jZURlZmluaXRpb246IC0+XG4gICAgcmFuZ2UgPSB1dGlscy5nZXRUZXh0QnVmZmVyUmFuZ2UoQGVkaXRvciwgXCJsaW5rXCIsIHNlbGVjdEJ5OiBcImN1cnJlbnRMaW5lXCIpXG5cbiAgICBpZiBsaW5rID0gdXRpbHMuZmluZExpbmtJblJhbmdlKEBlZGl0b3IsIHJhbmdlKVxuICAgICAgcmV0dXJuIGZhbHNlIGlmICFsaW5rLmlkICMgbm9ybWFsIGxpbmtcbiAgICAgIHJldHVybiBmYWxzZSBpZiAhbGluay5saW5rUmFuZ2UgfHwgIWxpbmsuZGVmaW5pdGlvblJhbmdlICMgb3JwaGFuIGxpbmtcblxuICAgICAgaWYgbGluay5saW5rUmFuZ2Uuc3RhcnQucm93ICE9IEBjdXJzb3Iucm93ICYmIGxpbmsubGlua1JhbmdlLmVuZC5yb3cgIT0gQGN1cnNvci5yb3dcbiAgICAgICAgcmV0dXJuIFtsaW5rLmxpbmtSYW5nZS5zdGFydC5yb3csIGxpbmsubGlua1JhbmdlLnN0YXJ0LmNvbHVtbl1cbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIFtsaW5rLmRlZmluaXRpb25SYW5nZS5zdGFydC5yb3csIGxpbmsuZGVmaW5pdGlvblJhbmdlLnN0YXJ0LmNvbHVtbl1cblxuICAgIGVsc2VcbiAgICAgIHNlbGVjdGlvbiA9IEBlZGl0b3IuZ2V0VGV4dEluUmFuZ2UocmFuZ2UpXG4gICAgICByZXR1cm4gZmFsc2UgdW5sZXNzIHNlbGVjdGlvblxuXG4gICAgICBsaW5rID0gUkVGRVJFTkNFX1JFR0VYLmV4ZWMoc2VsZWN0aW9uKVxuICAgICAgcmV0dXJuIGZhbHNlIHVubGVzcyBsaW5rXG5cbiAgICAgIGZvdW5kID0gZmFsc2VcbiAgICAgIEBlZGl0b3IuYnVmZmVyLnNjYW4gLy8vIFxcWyAje3V0aWxzLmVzY2FwZVJlZ0V4cChsaW5rWzFdKX0gXFxdIC8vL2csIChtYXRjaCkgPT5cbiAgICAgICAgaWYgbWF0Y2gucmFuZ2Uuc3RhcnQucm93ICE9IEBjdXJzb3Iucm93ICYmIG1hdGNoLnJhbmdlLmVuZC5yb3cgIT0gQGN1cnNvci5yb3dcbiAgICAgICAgICBmb3VuZCA9IFttYXRjaC5yYW5nZS5zdGFydC5yb3csIG1hdGNoLnJhbmdlLnN0YXJ0LmNvbHVtbl1cbiAgICAgICAgICBtYXRjaC5zdG9wKClcbiAgICAgIHJldHVybiBmb3VuZFxuXG4gIG5leHRUYWJsZUNlbGw6IC0+XG4gICAgbGluZSA9IEBlZGl0b3IubGluZVRleHRGb3JCdWZmZXJSb3coQGN1cnNvci5yb3cpXG5cbiAgICBpZiB1dGlscy5pc1RhYmxlUm93KGxpbmUpIHx8IHV0aWxzLmlzVGFibGVTZXBhcmF0b3IobGluZSlcbiAgICAgIEBfZmluZE5leHRUYWJsZUNlbGwobGluZSwgQGN1cnNvci5yb3csIEBjdXJzb3IuY29sdW1uKVxuICAgIGVsc2VcbiAgICAgIGZhbHNlXG5cbiAgX2ZpbmROZXh0VGFibGVDZWxsOiAoY3VycmVudExpbmUsIHJvdywgY29sdW1uKSAtPlxuICAgICMgZmluZCB0aGUgbmV4dCBjb2x1bW4gc2VwYXJhdG9yIG9uIGN1cnJlbnQgbGluZVxuICAgIGNvbHVtbiA9IGN1cnJlbnRMaW5lLmluZGV4T2YoXCJ8XCIsIGNvbHVtbilcblxuICAgICMgd2hlbiBhdCB0aGUgbGFzdCBjb2x1bW4gb2YgY3VycmVudCBsaW5lXG4gICAgaWYgY29sdW1uID09IC0xIHx8IGNvbHVtbiA9PSBjdXJyZW50TGluZS5sZW5ndGggLSAxXG4gICAgICByb3cgKz0gMVxuICAgICAgY29sdW1uID0gMFxuICAgICAgY3VycmVudExpbmUgPSBAZWRpdG9yLmxpbmVUZXh0Rm9yQnVmZmVyUm93KHJvdylcblxuICAgICMgd2hlbiBjdXJyZW50IGxpbmUgaXMgdGFibGUgc2VwYXJhdG9yXG4gICAgaWYgdXRpbHMuaXNUYWJsZVNlcGFyYXRvcihjdXJyZW50TGluZSlcbiAgICAgIHJvdyArPSAxXG4gICAgICBjb2x1bW4gPSAwXG4gICAgICBjdXJyZW50TGluZSA9IEBlZGl0b3IubGluZVRleHRGb3JCdWZmZXJSb3cocm93KVxuXG4gICAgIyBleGNlZWRzIHRoZSByb3cgb2YgY3VycmVudCBkb2N1bWVudFxuICAgIHJldHVybiBmYWxzZSBpZiBjdXJyZW50TGluZSA9PSB1bmRlZmluZWRcblxuICAgICMgc2tpcCB0aGUgcGlwZVxuICAgIGlmIGN1cnJlbnRMaW5lW2NvbHVtbl0gPT0gXCJ8XCJcbiAgICAgIGNvbHVtbiArPSAxXG4gICAgICBjdXJyZW50TGluZSA9IGN1cnJlbnRMaW5lW2NvbHVtbi4uXVxuXG4gICAgIyBmaW5kIHRoZSBjb3JyZWN0IGNlbGwgY29sdW1uIGJ5IGxlbmd0aFxuICAgIGlmIHRkID0gVEFCTEVfQ09MX1JFR0VYLmV4ZWMoY3VycmVudExpbmUpXG4gICAgICBbcm93LCBjb2x1bW4gKyB0ZFsxXS5sZW5ndGhdXG4gICAgZWxzZVxuICAgICAgW3JvdywgY29sdW1uICsgY3VycmVudExpbmUubGVuZ3RoXVxuIl19
