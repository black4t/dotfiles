function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

/* eslint-env jasmine */

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _libOrchestrator = require('./../lib/orchestrator');

var _asyncSpecHelpers = require('./async-spec-helpers');

// eslint-disable-line

'use babel';describe('orchestrator', function () {
  var orchestrator = null;

  (0, _asyncSpecHelpers.beforeEach)(_asyncToGenerator(function* () {
    orchestrator = new _libOrchestrator.Orchestrator();
    yield atom.packages.activatePackage('language-go');
  }));

  afterEach(function () {
    orchestrator.dispose();
  });

  describe('register', function () {
    (0, _asyncSpecHelpers.it)('throws an error if a callback is not provided', function () {
      expect(function () {
        orchestrator.register('test');
      }).toThrow();
    });

    (0, _asyncSpecHelpers.it)('throws an error if the callback is not a function', function () {
      expect(function () {
        orchestrator.register('test', 42);
      }).toThrow();
    });

    (0, _asyncSpecHelpers.it)('registers a callback that can be unregistered', function () {
      var callback = function callback() {};
      var disp = orchestrator.register('test', callback);
      expect(orchestrator.didSaveCallbacks.size).toBe(1);

      disp.dispose();
      expect(orchestrator.didSaveCallbacks.size).toBe(0);
    });

    (0, _asyncSpecHelpers.it)('runs a single callback', _asyncToGenerator(function* () {
      var called = false;
      var callback = function callback() {
        called = true;
        return Promise.resolve(true);
      };
      orchestrator.register('test', callback);

      var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
      var editor = yield atom.workspace.open(filepath);
      yield editor.save();
      expect(called).toBe(true);
    }));

    (0, _asyncSpecHelpers.it)('runs multiple callbacks', function () {
      var called = [false, false];

      (0, _asyncSpecHelpers.runs)(_asyncToGenerator(function* () {
        var callback0 = function callback0() {
          called[0] = true;
          return Promise.resolve(true);
        };
        var callback1 = function callback1() {
          called[1] = true;
          return Promise.resolve(true);
        };
        orchestrator.register('callback0', callback0);
        orchestrator.register('callback1', callback1);

        var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
        var editor = yield atom.workspace.open(filepath);
        yield editor.save();
      }));

      waitsFor(function () {
        return called[0] === true && called[1] === true;
      }, 'Both callbacks should be called', 1000);

      (0, _asyncSpecHelpers.runs)(function () {
        expect(called[0]).toBe(true);
        expect(called[1]).toBe(true);
      });
    });

    (0, _asyncSpecHelpers.it)('stops invoking callbacks when a promise is rejected', _asyncToGenerator(function* () {
      var called = [false, false];
      var callback0 = function callback0() {
        called[0] = true;
        return Promise.reject(new Error());
      };
      var callback1 = function callback1() {
        called[1] = true;
        return Promise.resolve(true);
      };
      orchestrator.register('callback0', callback0);
      orchestrator.register('callback1', callback1);

      var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
      var editor = yield atom.workspace.open(filepath);
      yield editor.save();

      expect(called[0]).toBe(true);
      expect(called[1]).toBe(false);
    }));
  });

  describe('register / onWillSave', function () {
    (0, _asyncSpecHelpers.it)('throws an error if a callback is not provided', function () {
      expect(function () {
        orchestrator.register('test', undefined, 'willSave');
      }).toThrow();
    });

    (0, _asyncSpecHelpers.it)('throws an error if the callback is not a function', function () {
      expect(function () {
        orchestrator.register('test', 42, 'willSave');
      }).toThrow();
    });

    (0, _asyncSpecHelpers.it)('registers a callback that can be unregistered', function () {
      var callback = function callback() {};
      var disp = orchestrator.register('test', callback, 'willSave');
      expect(orchestrator.willSaveCallbacks.size).toBe(1);

      disp.dispose();
      expect(orchestrator.willSaveCallbacks.size).toBe(0);
    });

    (0, _asyncSpecHelpers.it)('runs a single callback', _asyncToGenerator(function* () {
      var called = false;

      var callback = function callback() {
        called = true;
        return true;
      };
      orchestrator.register('test', callback, 'willSave');

      var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
      var editor = yield atom.workspace.open(filepath);
      yield editor.save();
      expect(called).toBe(true);
    }));

    (0, _asyncSpecHelpers.it)('runs multiple callbacks', _asyncToGenerator(function* () {
      var called = [false, false];

      var callback0 = function callback0() {
        called[0] = true;
        return true;
      };
      var callback1 = function callback1() {
        called[1] = true;
        return true;
      };
      orchestrator.register('test', callback0, 'willSave');
      orchestrator.register('test', callback1, 'willSave');

      var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
      var editor = yield atom.workspace.open(filepath);
      yield editor.save();

      expect(called[0]).toBe(true);
      expect(called[1]).toBe(true);
    }));

    (0, _asyncSpecHelpers.it)('stops invoking callbacks when encountering a non-true return value', _asyncToGenerator(function* () {
      var called = [false, false];

      var callback0 = function callback0() {
        called[0] = true;
        return false;
      };
      var callback1 = function callback1() {
        called[1] = true;
        return true;
      };
      orchestrator.register('test', callback0, 'willSave');
      orchestrator.register('test', callback1, 'willSave');

      var filepath = _path2['default'].join(__dirname, 'fixtures', 'main.go');
      var editor = yield atom.workspace.open(filepath);
      yield editor.save();

      expect(called[0]).toBe(true);
      expect(called[1]).toBe(false);
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLXBsdXMvc3BlYy9vcmNoZXN0cmF0b3Itc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBR2lCLE1BQU07Ozs7K0JBQ00sdUJBQXVCOztnQ0FDSixzQkFBc0I7Ozs7QUFMdEUsV0FBVyxDQUFBLEFBT1gsUUFBUSxDQUFDLGNBQWMsRUFBRSxZQUFNO0FBQzdCLE1BQUksWUFBWSxHQUFHLElBQUksQ0FBQTs7QUFFdkIsc0RBQVcsYUFBWTtBQUNyQixnQkFBWSxHQUFHLG1DQUFrQixDQUFBO0FBQ2pDLFVBQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLENBQUE7R0FDbkQsRUFBQyxDQUFBOztBQUVGLFdBQVMsQ0FBQyxZQUFNO0FBQ2QsZ0JBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtHQUN2QixDQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLFVBQVUsRUFBRSxZQUFNO0FBQ3pCLDhCQUFHLCtDQUErQyxFQUFFLFlBQU07QUFDeEQsWUFBTSxDQUFDLFlBQU07QUFDWCxvQkFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtPQUM5QixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUE7S0FDYixDQUFDLENBQUE7O0FBRUYsOEJBQUcsbURBQW1ELEVBQUUsWUFBTTtBQUM1RCxZQUFNLENBQUMsWUFBTTtBQUNYLG9CQUFZLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQTtPQUNsQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUE7S0FDYixDQUFDLENBQUE7O0FBRUYsOEJBQUcsK0NBQStDLEVBQUUsWUFBTTtBQUN4RCxVQUFNLFFBQVEsR0FBRyxTQUFYLFFBQVEsR0FBUyxFQUFFLENBQUE7QUFDekIsVUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFDcEQsWUFBTSxDQUFDLFlB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QVMsR0FBUztBQUN0QixjQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO0FBQ2hCLGVBQU8sS0FBSyxDQUFBO09BQ2IsQ0FBQTtBQUNELFVBQU0sU0FBUyxHQUFHLFNBQVosU0FBUyxHQUFTO0FBQ3RCLGNBQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUE7QUFDaEIsZUFBTyxJQUFJLENBQUE7T0FDWixDQUFBO0FBQ0Qsa0JBQVksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQTtBQUNwRCxrQkFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFBOztBQUVwRCxVQUFNLFFBQVEsR0FBRyxrQkFBSyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQTtBQUM1RCxVQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ2xELFlBQU0sTUFBTSxDQUFDLElBQUksRUFBRSxDQUFBOztBQUVuQixZQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzVCLFlBQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7S0FDOUIsRUFBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBO0NBQ0gsQ0FBQyxDQUFBIiwiZmlsZSI6Ii9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLXBsdXMvc3BlYy9vcmNoZXN0cmF0b3Itc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG4vKiBlc2xpbnQtZW52IGphc21pbmUgKi9cblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IE9yY2hlc3RyYXRvciB9IGZyb20gJy4vLi4vbGliL29yY2hlc3RyYXRvcidcbmltcG9ydCB7IGl0LCBmaXQsIGZmaXQsIGJlZm9yZUVhY2gsIHJ1bnMgfSBmcm9tICcuL2FzeW5jLXNwZWMtaGVscGVycycgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG5kZXNjcmliZSgnb3JjaGVzdHJhdG9yJywgKCkgPT4ge1xuICBsZXQgb3JjaGVzdHJhdG9yID0gbnVsbFxuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIG9yY2hlc3RyYXRvciA9IG5ldyBPcmNoZXN0cmF0b3IoKVxuICAgIGF3YWl0IGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdsYW5ndWFnZS1nbycpXG4gIH0pXG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBvcmNoZXN0cmF0b3IuZGlzcG9zZSgpXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ3JlZ2lzdGVyJywgKCkgPT4ge1xuICAgIGl0KCd0aHJvd3MgYW4gZXJyb3IgaWYgYSBjYWxsYmFjayBpcyBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBvcmNoZXN0cmF0b3IucmVnaXN0ZXIoJ3Rlc3QnKVxuICAgICAgfSkudG9UaHJvdygpXG4gICAgfSlcblxuICAgIGl0KCd0aHJvd3MgYW4gZXJyb3IgaWYgdGhlIGNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgNDIpXG4gICAgICB9KS50b1Rocm93KClcbiAgICB9KVxuXG4gICAgaXQoJ3JlZ2lzdGVycyBhIGNhbGxiYWNrIHRoYXQgY2FuIGJlIHVucmVnaXN0ZXJlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGxiYWNrID0gKCkgPT4ge31cbiAgICAgIGNvbnN0IGRpc3AgPSBvcmNoZXN0cmF0b3IucmVnaXN0ZXIoJ3Rlc3QnLCBjYWxsYmFjaylcbiAgICAgIGV4cGVjdChvcmNoZXN0cmF0b3IuZGlkU2F2ZUNhbGxiYWNrcy5zaXplKS50b0JlKDEpXG5cbiAgICAgIGRpc3AuZGlzcG9zZSgpXG4gICAgICBleHBlY3Qob3JjaGVzdHJhdG9yLmRpZFNhdmVDYWxsYmFja3Muc2l6ZSkudG9CZSgwKVxuICAgIH0pXG5cbiAgICBpdCgncnVucyBhIHNpbmdsZSBjYWxsYmFjaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBjYWxsZWQgPSBmYWxzZVxuICAgICAgY29uc3QgY2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICAgIGNhbGxlZCA9IHRydWVcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxuICAgICAgfVxuICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgY2FsbGJhY2spXG5cbiAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ21haW4uZ28nKVxuICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlcGF0aClcbiAgICAgIGF3YWl0IGVkaXRvci5zYXZlKClcbiAgICAgIGV4cGVjdChjYWxsZWQpLnRvQmUodHJ1ZSlcbiAgICB9KVxuXG4gICAgaXQoJ3J1bnMgbXVsdGlwbGUgY2FsbGJhY2tzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbGVkID0gW2ZhbHNlLCBmYWxzZV1cblxuICAgICAgcnVucyhhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrMCA9ICgpID0+IHtcbiAgICAgICAgICBjYWxsZWRbMF0gPSB0cnVlXG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrMSA9ICgpID0+IHtcbiAgICAgICAgICBjYWxsZWRbMV0gPSB0cnVlXG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxuICAgICAgICB9XG4gICAgICAgIG9yY2hlc3RyYXRvci5yZWdpc3RlcignY2FsbGJhY2swJywgY2FsbGJhY2swKVxuICAgICAgICBvcmNoZXN0cmF0b3IucmVnaXN0ZXIoJ2NhbGxiYWNrMScsIGNhbGxiYWNrMSlcblxuICAgICAgICBjb25zdCBmaWxlcGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsICdtYWluLmdvJylcbiAgICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlcGF0aClcbiAgICAgICAgYXdhaXQgZWRpdG9yLnNhdmUoKVxuICAgICAgfSlcblxuICAgICAgd2FpdHNGb3IoXG4gICAgICAgICgpID0+IGNhbGxlZFswXSA9PT0gdHJ1ZSAmJiBjYWxsZWRbMV0gPT09IHRydWUsXG4gICAgICAgICdCb3RoIGNhbGxiYWNrcyBzaG91bGQgYmUgY2FsbGVkJyxcbiAgICAgICAgMTAwMFxuICAgICAgKVxuXG4gICAgICBydW5zKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KGNhbGxlZFswXSkudG9CZSh0cnVlKVxuICAgICAgICBleHBlY3QoY2FsbGVkWzFdKS50b0JlKHRydWUpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpdCgnc3RvcHMgaW52b2tpbmcgY2FsbGJhY2tzIHdoZW4gYSBwcm9taXNlIGlzIHJlamVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGNhbGxlZCA9IFtmYWxzZSwgZmFsc2VdXG4gICAgICBjb25zdCBjYWxsYmFjazAgPSAoKSA9PiB7XG4gICAgICAgIGNhbGxlZFswXSA9IHRydWVcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigpKVxuICAgICAgfVxuICAgICAgY29uc3QgY2FsbGJhY2sxID0gKCkgPT4ge1xuICAgICAgICBjYWxsZWRbMV0gPSB0cnVlXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSlcbiAgICAgIH1cbiAgICAgIG9yY2hlc3RyYXRvci5yZWdpc3RlcignY2FsbGJhY2swJywgY2FsbGJhY2swKVxuICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCdjYWxsYmFjazEnLCBjYWxsYmFjazEpXG5cbiAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ21haW4uZ28nKVxuICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlcGF0aClcbiAgICAgIGF3YWl0IGVkaXRvci5zYXZlKClcblxuICAgICAgZXhwZWN0KGNhbGxlZFswXSkudG9CZSh0cnVlKVxuICAgICAgZXhwZWN0KGNhbGxlZFsxXSkudG9CZShmYWxzZSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdyZWdpc3RlciAvIG9uV2lsbFNhdmUnLCAoKSA9PiB7XG4gICAgaXQoJ3Rocm93cyBhbiBlcnJvciBpZiBhIGNhbGxiYWNrIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIG9yY2hlc3RyYXRvci5yZWdpc3RlcigndGVzdCcsIHVuZGVmaW5lZCwgJ3dpbGxTYXZlJylcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgIH0pXG5cbiAgICBpdCgndGhyb3dzIGFuIGVycm9yIGlmIHRoZSBjYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIG9yY2hlc3RyYXRvci5yZWdpc3RlcigndGVzdCcsIDQyLCAnd2lsbFNhdmUnKVxuICAgICAgfSkudG9UaHJvdygpXG4gICAgfSlcblxuICAgIGl0KCdyZWdpc3RlcnMgYSBjYWxsYmFjayB0aGF0IGNhbiBiZSB1bnJlZ2lzdGVyZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHt9XG4gICAgICBjb25zdCBkaXNwID0gb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgY2FsbGJhY2ssICd3aWxsU2F2ZScpXG4gICAgICBleHBlY3Qob3JjaGVzdHJhdG9yLndpbGxTYXZlQ2FsbGJhY2tzLnNpemUpLnRvQmUoMSlcblxuICAgICAgZGlzcC5kaXNwb3NlKClcbiAgICAgIGV4cGVjdChvcmNoZXN0cmF0b3Iud2lsbFNhdmVDYWxsYmFja3Muc2l6ZSkudG9CZSgwKVxuICAgIH0pXG5cbiAgICBpdCgncnVucyBhIHNpbmdsZSBjYWxsYmFjaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBjYWxsZWQgPSBmYWxzZVxuXG4gICAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHtcbiAgICAgICAgY2FsbGVkID0gdHJ1ZVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgY2FsbGJhY2ssICd3aWxsU2F2ZScpXG5cbiAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ21haW4uZ28nKVxuICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlcGF0aClcbiAgICAgIGF3YWl0IGVkaXRvci5zYXZlKClcbiAgICAgIGV4cGVjdChjYWxsZWQpLnRvQmUodHJ1ZSlcbiAgICB9KVxuXG4gICAgaXQoJ3J1bnMgbXVsdGlwbGUgY2FsbGJhY2tzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGNhbGxlZCA9IFtmYWxzZSwgZmFsc2VdXG5cbiAgICAgIGNvbnN0IGNhbGxiYWNrMCA9ICgpID0+IHtcbiAgICAgICAgY2FsbGVkWzBdID0gdHJ1ZVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgY29uc3QgY2FsbGJhY2sxID0gKCkgPT4ge1xuICAgICAgICBjYWxsZWRbMV0gPSB0cnVlXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICBvcmNoZXN0cmF0b3IucmVnaXN0ZXIoJ3Rlc3QnLCBjYWxsYmFjazAsICd3aWxsU2F2ZScpXG4gICAgICBvcmNoZXN0cmF0b3IucmVnaXN0ZXIoJ3Rlc3QnLCBjYWxsYmFjazEsICd3aWxsU2F2ZScpXG5cbiAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ21haW4uZ28nKVxuICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlcGF0aClcbiAgICAgIGF3YWl0IGVkaXRvci5zYXZlKClcblxuICAgICAgZXhwZWN0KGNhbGxlZFswXSkudG9CZSh0cnVlKVxuICAgICAgZXhwZWN0KGNhbGxlZFsxXSkudG9CZSh0cnVlKVxuICAgIH0pXG5cbiAgICBpdCgnc3RvcHMgaW52b2tpbmcgY2FsbGJhY2tzIHdoZW4gZW5jb3VudGVyaW5nIGEgbm9uLXRydWUgcmV0dXJuIHZhbHVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGNhbGxlZCA9IFtmYWxzZSwgZmFsc2VdXG5cbiAgICAgIGNvbnN0IGNhbGxiYWNrMCA9ICgpID0+IHtcbiAgICAgICAgY2FsbGVkWzBdID0gdHJ1ZVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNhbGxiYWNrMSA9ICgpID0+IHtcbiAgICAgICAgY2FsbGVkWzFdID0gdHJ1ZVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgY2FsbGJhY2swLCAnd2lsbFNhdmUnKVxuICAgICAgb3JjaGVzdHJhdG9yLnJlZ2lzdGVyKCd0ZXN0JywgY2FsbGJhY2sxLCAnd2lsbFNhdmUnKVxuXG4gICAgICBjb25zdCBmaWxlcGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsICdtYWluLmdvJylcbiAgICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IGF0b20ud29ya3NwYWNlLm9wZW4oZmlsZXBhdGgpXG4gICAgICBhd2FpdCBlZGl0b3Iuc2F2ZSgpXG5cbiAgICAgIGV4cGVjdChjYWxsZWRbMF0pLnRvQmUodHJ1ZSlcbiAgICAgIGV4cGVjdChjYWxsZWRbMV0pLnRvQmUoZmFsc2UpXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=