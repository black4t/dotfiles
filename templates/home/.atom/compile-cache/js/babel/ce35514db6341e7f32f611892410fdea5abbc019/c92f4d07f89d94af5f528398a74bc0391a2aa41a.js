function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

/* eslint-env jasmine */

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fsExtra = require('fs-extra');

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _specHelpers = require('./../spec-helpers');

var _asyncSpecHelpers = require('../async-spec-helpers');

// eslint-disable-line

'use babel';describe('gomodifytags', function () {
  var gopath = null;
  var editor = null;
  var gomodifytags = null;
  var source = null;
  var target = null;

  (0, _asyncSpecHelpers.beforeEach)(_asyncToGenerator(function* () {
    _specHelpers.lifecycle.setup();
    gopath = _fsExtra2['default'].realpathSync(_specHelpers.lifecycle.temp.mkdirSync('gopath-'));
    process.env.GOPATH = gopath;
    yield _specHelpers.lifecycle.activatePackage();
    var mainModule = _specHelpers.lifecycle.mainModule;

    mainModule.provideGoConfig();
    gomodifytags = mainModule.loadGoModifyTags();
  }));

  afterEach(function () {
    _specHelpers.lifecycle.teardown();
  });

  describe('when a file is open', function () {
    var tempfile = undefined;
    (0, _asyncSpecHelpers.beforeEach)(_asyncToGenerator(function* () {
      source = _path2['default'].join(__dirname, '..', 'fixtures', 'gomodifytags');
      target = _path2['default'].join(gopath, 'src', 'gomodifytags');
      _fsExtra2['default'].copySync(source, target);
      tempfile = _path2['default'].join(target, 'foo.go');
      editor = yield atom.workspace.open(tempfile);
    }));

    describe('argument builder', function () {
      var options = undefined;

      (0, _asyncSpecHelpers.beforeEach)(function () {
        options = {
          tags: [{ tag: 'xml', option: null }, { tag: 'bson', option: null }],
          transform: 'snakecase',
          sortTags: false
        };
      });

      (0, _asyncSpecHelpers.it)('includes the -file option', function () {
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        expect(args.length).toBeGreaterThan(1);
        expect(args[0]).toBe('-file');
        expect(args[1]).toBe(tempfile);
      });

      (0, _asyncSpecHelpers.it)('defaults to json if no tags are specified', function () {
        editor.setCursorBufferPosition([4, 6]);
        options.tags = [];
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        var i = args.indexOf('-add-tags');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('json');
        expect(args.includes('-add-options')).toBe(false);
      });

      (0, _asyncSpecHelpers.it)('specifies tags correctly', function () {
        editor.setCursorBufferPosition([4, 6]);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        var i = args.indexOf('-add-tags');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('xml,bson');
      });

      (0, _asyncSpecHelpers.it)('uses the -offset flag if there is no selection', function () {
        editor.setCursorBufferPosition([4, 6]);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        expect(args.length).toBeGreaterThan(3);
        expect(args[2]).toBe('-offset');
        expect(args[3]).toBe('54');
      });

      (0, _asyncSpecHelpers.it)('uses the -line flag when there is a selection', function () {
        editor.setSelectedBufferRange([[3, 2], [4, 6]]);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        expect(args.length).toBeGreaterThan(3);
        expect(args[2]).toBe('-line');
        expect(args[3]).toBe('4,5');
      });

      (0, _asyncSpecHelpers.it)('uses the -modified flag when the buffer is modified', function () {
        editor.setCursorBufferPosition([4, 6]);
        editor.insertNewlineBelow();
        expect(editor.isModified()).toBe(true);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        expect(args.includes('-modified')).toBe(true);
      });

      (0, _asyncSpecHelpers.it)('uses the -transform flag when camel case is specified', function () {
        options.transform = 'camelcase';
        editor.setCursorBufferPosition([4, 6]);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        var i = args.indexOf('-transform');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('camelcase');
      });

      (0, _asyncSpecHelpers.it)('uses the -sort flag when the sort option is enabled', function () {
        options.sortTags = true;
        editor.setCursorBufferPosition([4, 6]);
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        expect(args.includes('-sort')).toBe(true);
      });

      (0, _asyncSpecHelpers.it)('includes the -add-options flag if options were specified for add', function () {
        editor.setCursorBufferPosition([4, 6]);
        options.tags = [{ tag: 'bson', option: 'omitempty' }, { tag: 'xml', option: 'foo' }];
        var args = gomodifytags.buildArgs(editor, options, 'Add');
        var i = args.indexOf('-add-tags');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('bson,xml');

        i = args.indexOf('-add-options');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('bson=omitempty,xml=foo');
      });

      (0, _asyncSpecHelpers.it)('uses the -clear-tags flag if no tags are specified for remove', function () {
        editor.setCursorBufferPosition([4, 6]);
        options.tags = [];
        var args = gomodifytags.buildArgs(editor, options, 'Remove');
        expect(args.includes('-clear-tags')).toBe(true);
      });

      (0, _asyncSpecHelpers.it)('includes the -remove-tags flag if no options are specified for remove', function () {
        editor.setCursorBufferPosition([4, 6]);
        options.tags = [{ tag: 'json', option: null }];
        var args = gomodifytags.buildArgs(editor, options, 'Remove');
        expect(args.includes('-remove-options')).toBe(false);
        var i = args.indexOf('-remove-tags');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('json');
      });

      (0, _asyncSpecHelpers.it)('includes the -remove-options flag if options are specified for remove', function () {
        editor.setCursorBufferPosition([4, 6]);
        options.tags = [{ tag: 'json', option: 'omitempty' }];
        var args = gomodifytags.buildArgs(editor, options, 'Remove');
        expect(args.includes('-remove-tags')).toBe(false);
        var i = args.indexOf('-remove-options');
        expect(i).not.toBe(-1);
        expect(args[i + 1]).toBe('json=omitempty');
      });
    });

    describe('when modifying tags', function () {
      (0, _asyncSpecHelpers.it)('adds json tags with options', _asyncToGenerator(function* () {
        editor.setCursorBufferPosition([4, 6]);
        var command = yield _specHelpers.lifecycle.mainModule.provideGoConfig().locator.findTool('gomodifytags');
        expect(command).toBeTruthy();

        var result = yield gomodifytags.modifyTags(editor, {
          tags: [{ tag: 'json', option: 'omitempty' }],
          transform: 'snakecase',
          sortTags: false
        }, 'Add', command);

        expect(result).toBeTruthy();
        expect(result.success).toBe(true);
        expect(result.result.stdout).toBe('package foo\n\ntype Bar struct {\n\tQuickBrownFox int    `json:"quick_brown_fox,omitempty"`\n\tLazyDog       string `json:"lazy_dog,omitempty"`\n}\n\n');
      }));

      (0, _asyncSpecHelpers.it)('returns an error if the cursor is not inside a struct declaration', _asyncToGenerator(function* () {
        editor.setCursorBufferPosition([0, 2]);
        var command = yield _specHelpers.lifecycle.mainModule.provideGoConfig().locator.findTool('gomodifytags');
        var result = yield gomodifytags.modifyTags(editor, { tags: [] }, 'Add', command);
        expect(result).toBeTruthy();
        expect(result.success).toBe(false);
      }));
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLXBsdXMvc3BlYy90YWdzL2dvbW9kaWZ5dGFncy1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFHaUIsTUFBTTs7Ozt1QkFDUixVQUFVOzs7OzJCQUNDLG1CQUFtQjs7Z0NBQ0csdUJBQXVCOzs7O0FBTnZFLFdBQVcsQ0FBQSxBQVFYLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBTTtBQUM3QixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2pCLE1BQUksWUFBWSxHQUFHLElBQUksQ0FBQTtBQUN2QixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBOztBQUVqQixzREFBVyxhQUFZO0FBQ3JCLDJCQUFVLEtBQUssRUFBRSxDQUFBO0FBQ2pCLFVBQU0sR0FBRyxxQkFBRyxZQUFZLENBQUMsdUJBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO0FBQzdELFdBQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtBQUMzQixVQUFNLHVCQUFVLGVBQWUsRUFBRSxDQUFBO1FBQ3pCLFVBQVUsMEJBQVYsVUFBVTs7QUFDbEIsY0FBVSxDQUFDLGVBQWUsRUFBRSxDQUFBO0FBQzVCLGdCQUFZLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixFQUFFLENBQUE7R0FDN0MsRUFBQyxDQUFBOztBQUVGLFdBQVMsQ0FBQyxZQUFNO0FBQ2QsMkJBQVUsUUFBUSxFQUFFLENBQUE7R0FDckIsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyxxQkFBcUIsRUFBRSxZQUFNO0FBQ3BDLFFBQUksUUFBUSxZQUFBLENBQUE7QUFDWix3REFBVyxhQUFZO0FBQ3JCLFlBQU0sR0FBRyxrQkFBSyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsY0FB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LEVBQUUsS0FBSztTQUNoQixFQUNELEtBQUssRUFDTCxPQUFPLENBQ1IsQ0FBQTs7QUFFRCxjQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUE7QUFDM0IsY0FBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDakMsY0FBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUMvQix3SkFBd0osQ0FDekosQ0FBQTtPQUNGLEVBQUMsQ0FBQTs7QUFFRixnQ0FBRyxtRUFBbUUsb0JBQUUsYUFBWTtBQUNsRixjQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUN0QyxZQUFNLE9BQU8sR0FBRyxNQUFNLHVCQUFVLFVBQVUsQ0FDdkMsZUFBZSxFQUFFLENBQ2pCLE9BQU8sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLENBQUE7QUFDbkMsWUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLENBQUMsVUFBVSxDQUMxQyxNQUFNLEVBQ04sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQ1osS0FBSyxFQUNMLE9BQU8sQ0FDUixDQUFBO0FBQ0QsY0FBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFBO0FBQzNCLGNBQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO09BQ25DLEVBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvaG9tZS9teXVnYS8uYXRvbS9wYWNrYWdlcy9nby1wbHVzL3NwZWMvdGFncy9nb21vZGlmeXRhZ3Mtc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG4vKiBlc2xpbnQtZW52IGphc21pbmUgKi9cblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSdcbmltcG9ydCB7IGxpZmVjeWNsZSB9IGZyb20gJy4vLi4vc3BlYy1oZWxwZXJzJ1xuaW1wb3J0IHsgaXQsIGZpdCwgZmZpdCwgYmVmb3JlRWFjaCwgcnVucyB9IGZyb20gJy4uL2FzeW5jLXNwZWMtaGVscGVycycgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG5kZXNjcmliZSgnZ29tb2RpZnl0YWdzJywgKCkgPT4ge1xuICBsZXQgZ29wYXRoID0gbnVsbFxuICBsZXQgZWRpdG9yID0gbnVsbFxuICBsZXQgZ29tb2RpZnl0YWdzID0gbnVsbFxuICBsZXQgc291cmNlID0gbnVsbFxuICBsZXQgdGFyZ2V0ID0gbnVsbFxuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGxpZmVjeWNsZS5zZXR1cCgpXG4gICAgZ29wYXRoID0gZnMucmVhbHBhdGhTeW5jKGxpZmVjeWNsZS50ZW1wLm1rZGlyU3luYygnZ29wYXRoLScpKVxuICAgIHByb2Nlc3MuZW52LkdPUEFUSCA9IGdvcGF0aFxuICAgIGF3YWl0IGxpZmVjeWNsZS5hY3RpdmF0ZVBhY2thZ2UoKVxuICAgIGNvbnN0IHsgbWFpbk1vZHVsZSB9ID0gbGlmZWN5Y2xlXG4gICAgbWFpbk1vZHVsZS5wcm92aWRlR29Db25maWcoKVxuICAgIGdvbW9kaWZ5dGFncyA9IG1haW5Nb2R1bGUubG9hZEdvTW9kaWZ5VGFncygpXG4gIH0pXG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBsaWZlY3ljbGUudGVhcmRvd24oKVxuICB9KVxuXG4gIGRlc2NyaWJlKCd3aGVuIGEgZmlsZSBpcyBvcGVuJywgKCkgPT4ge1xuICAgIGxldCB0ZW1wZmlsZVxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgc291cmNlID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ2ZpeHR1cmVzJywgJ2dvbW9kaWZ5dGFncycpXG4gICAgICB0YXJnZXQgPSBwYXRoLmpvaW4oZ29wYXRoLCAnc3JjJywgJ2dvbW9kaWZ5dGFncycpXG4gICAgICBmcy5jb3B5U3luYyhzb3VyY2UsIHRhcmdldClcbiAgICAgIHRlbXBmaWxlID0gcGF0aC5qb2luKHRhcmdldCwgJ2Zvby5nbycpXG4gICAgICBlZGl0b3IgPSBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKHRlbXBmaWxlKVxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnYXJndW1lbnQgYnVpbGRlcicsICgpID0+IHtcbiAgICAgIGxldCBvcHRpb25zXG5cbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgIHRhZ3M6IFt7IHRhZzogJ3htbCcsIG9wdGlvbjogbnVsbCB9LCB7IHRhZzogJ2Jzb24nLCBvcHRpb246IG51bGwgfV0sXG4gICAgICAgICAgdHJhbnNmb3JtOiAnc25ha2VjYXNlJyxcbiAgICAgICAgICBzb3J0VGFnczogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgaXQoJ2luY2x1ZGVzIHRoZSAtZmlsZSBvcHRpb24nLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFyZ3MgPSBnb21vZGlmeXRhZ3MuYnVpbGRBcmdzKGVkaXRvciwgb3B0aW9ucywgJ0FkZCcpXG4gICAgICAgIGV4cGVjdChhcmdzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDEpXG4gICAgICAgIGV4cGVjdChhcmdzWzBdKS50b0JlKCctZmlsZScpXG4gICAgICAgIGV4cGVjdChhcmdzWzFdKS50b0JlKHRlbXBmaWxlKVxuICAgICAgfSlcblxuICAgICAgaXQoJ2RlZmF1bHRzIHRvIGpzb24gaWYgbm8gdGFncyBhcmUgc3BlY2lmaWVkJywgKCkgPT4ge1xuICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDZdKVxuICAgICAgICBvcHRpb25zLnRhZ3MgPSBbXVxuICAgICAgICBjb25zdCBhcmdzID0gZ29tb2RpZnl0YWdzLmJ1aWxkQXJncyhlZGl0b3IsIG9wdGlvbnMsICdBZGQnKVxuICAgICAgICBjb25zdCBpID0gYXJncy5pbmRleE9mKCctYWRkLXRhZ3MnKVxuICAgICAgICBleHBlY3QoaSkubm90LnRvQmUoLTEpXG4gICAgICAgIGV4cGVjdChhcmdzW2kgKyAxXSkudG9CZSgnanNvbicpXG4gICAgICAgIGV4cGVjdChhcmdzLmluY2x1ZGVzKCctYWRkLW9wdGlvbnMnKSkudG9CZShmYWxzZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdzcGVjaWZpZXMgdGFncyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbNCwgNl0pXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBnb21vZGlmeXRhZ3MuYnVpbGRBcmdzKGVkaXRvciwgb3B0aW9ucywgJ0FkZCcpXG4gICAgICAgIGNvbnN0IGkgPSBhcmdzLmluZGV4T2YoJy1hZGQtdGFncycpXG4gICAgICAgIGV4cGVjdChpKS5ub3QudG9CZSgtMSlcbiAgICAgICAgZXhwZWN0KGFyZ3NbaSArIDFdKS50b0JlKCd4bWwsYnNvbicpXG4gICAgICB9KVxuXG4gICAgICBpdCgndXNlcyB0aGUgLW9mZnNldCBmbGFnIGlmIHRoZXJlIGlzIG5vIHNlbGVjdGlvbicsICgpID0+IHtcbiAgICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFs0LCA2XSlcbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgZXhwZWN0KGFyZ3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMylcbiAgICAgICAgZXhwZWN0KGFyZ3NbMl0pLnRvQmUoJy1vZmZzZXQnKVxuICAgICAgICBleHBlY3QoYXJnc1szXSkudG9CZSgnNTQnKVxuICAgICAgfSlcblxuICAgICAgaXQoJ3VzZXMgdGhlIC1saW5lIGZsYWcgd2hlbiB0aGVyZSBpcyBhIHNlbGVjdGlvbicsICgpID0+IHtcbiAgICAgICAgZWRpdG9yLnNldFNlbGVjdGVkQnVmZmVyUmFuZ2UoW1szLCAyXSwgWzQsIDZdXSlcbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgZXhwZWN0KGFyZ3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMylcbiAgICAgICAgZXhwZWN0KGFyZ3NbMl0pLnRvQmUoJy1saW5lJylcbiAgICAgICAgZXhwZWN0KGFyZ3NbM10pLnRvQmUoJzQsNScpXG4gICAgICB9KVxuXG4gICAgICBpdCgndXNlcyB0aGUgLW1vZGlmaWVkIGZsYWcgd2hlbiB0aGUgYnVmZmVyIGlzIG1vZGlmaWVkJywgKCkgPT4ge1xuICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDZdKVxuICAgICAgICBlZGl0b3IuaW5zZXJ0TmV3bGluZUJlbG93KClcbiAgICAgICAgZXhwZWN0KGVkaXRvci5pc01vZGlmaWVkKCkpLnRvQmUodHJ1ZSlcbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgZXhwZWN0KGFyZ3MuaW5jbHVkZXMoJy1tb2RpZmllZCcpKS50b0JlKHRydWUpXG4gICAgICB9KVxuXG4gICAgICBpdCgndXNlcyB0aGUgLXRyYW5zZm9ybSBmbGFnIHdoZW4gY2FtZWwgY2FzZSBpcyBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICAgIG9wdGlvbnMudHJhbnNmb3JtID0gJ2NhbWVsY2FzZSdcbiAgICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFs0LCA2XSlcbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgY29uc3QgaSA9IGFyZ3MuaW5kZXhPZignLXRyYW5zZm9ybScpXG4gICAgICAgIGV4cGVjdChpKS5ub3QudG9CZSgtMSlcbiAgICAgICAgZXhwZWN0KGFyZ3NbaSArIDFdKS50b0JlKCdjYW1lbGNhc2UnKVxuICAgICAgfSlcblxuICAgICAgaXQoJ3VzZXMgdGhlIC1zb3J0IGZsYWcgd2hlbiB0aGUgc29ydCBvcHRpb24gaXMgZW5hYmxlZCcsICgpID0+IHtcbiAgICAgICAgb3B0aW9ucy5zb3J0VGFncyA9IHRydWVcbiAgICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFs0LCA2XSlcbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgZXhwZWN0KGFyZ3MuaW5jbHVkZXMoJy1zb3J0JykpLnRvQmUodHJ1ZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdpbmNsdWRlcyB0aGUgLWFkZC1vcHRpb25zIGZsYWcgaWYgb3B0aW9ucyB3ZXJlIHNwZWNpZmllZCBmb3IgYWRkJywgKCkgPT4ge1xuICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDZdKVxuICAgICAgICBvcHRpb25zLnRhZ3MgPSBbXG4gICAgICAgICAgeyB0YWc6ICdic29uJywgb3B0aW9uOiAnb21pdGVtcHR5JyB9LFxuICAgICAgICAgIHsgdGFnOiAneG1sJywgb3B0aW9uOiAnZm9vJyB9XG4gICAgICAgIF1cbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnQWRkJylcbiAgICAgICAgbGV0IGkgPSBhcmdzLmluZGV4T2YoJy1hZGQtdGFncycpXG4gICAgICAgIGV4cGVjdChpKS5ub3QudG9CZSgtMSlcbiAgICAgICAgZXhwZWN0KGFyZ3NbaSArIDFdKS50b0JlKCdic29uLHhtbCcpXG5cbiAgICAgICAgaSA9IGFyZ3MuaW5kZXhPZignLWFkZC1vcHRpb25zJylcbiAgICAgICAgZXhwZWN0KGkpLm5vdC50b0JlKC0xKVxuICAgICAgICBleHBlY3QoYXJnc1tpICsgMV0pLnRvQmUoJ2Jzb249b21pdGVtcHR5LHhtbD1mb28nKVxuICAgICAgfSlcblxuICAgICAgaXQoJ3VzZXMgdGhlIC1jbGVhci10YWdzIGZsYWcgaWYgbm8gdGFncyBhcmUgc3BlY2lmaWVkIGZvciByZW1vdmUnLCAoKSA9PiB7XG4gICAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbNCwgNl0pXG4gICAgICAgIG9wdGlvbnMudGFncyA9IFtdXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBnb21vZGlmeXRhZ3MuYnVpbGRBcmdzKGVkaXRvciwgb3B0aW9ucywgJ1JlbW92ZScpXG4gICAgICAgIGV4cGVjdChhcmdzLmluY2x1ZGVzKCctY2xlYXItdGFncycpKS50b0JlKHRydWUpXG4gICAgICB9KVxuXG4gICAgICBpdCgnaW5jbHVkZXMgdGhlIC1yZW1vdmUtdGFncyBmbGFnIGlmIG5vIG9wdGlvbnMgYXJlIHNwZWNpZmllZCBmb3IgcmVtb3ZlJywgKCkgPT4ge1xuICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDZdKVxuICAgICAgICBvcHRpb25zLnRhZ3MgPSBbeyB0YWc6ICdqc29uJywgb3B0aW9uOiBudWxsIH1dXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBnb21vZGlmeXRhZ3MuYnVpbGRBcmdzKGVkaXRvciwgb3B0aW9ucywgJ1JlbW92ZScpXG4gICAgICAgIGV4cGVjdChhcmdzLmluY2x1ZGVzKCctcmVtb3ZlLW9wdGlvbnMnKSkudG9CZShmYWxzZSlcbiAgICAgICAgY29uc3QgaSA9IGFyZ3MuaW5kZXhPZignLXJlbW92ZS10YWdzJylcbiAgICAgICAgZXhwZWN0KGkpLm5vdC50b0JlKC0xKVxuICAgICAgICBleHBlY3QoYXJnc1tpICsgMV0pLnRvQmUoJ2pzb24nKVxuICAgICAgfSlcblxuICAgICAgaXQoJ2luY2x1ZGVzIHRoZSAtcmVtb3ZlLW9wdGlvbnMgZmxhZyBpZiBvcHRpb25zIGFyZSBzcGVjaWZpZWQgZm9yIHJlbW92ZScsICgpID0+IHtcbiAgICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFs0LCA2XSlcbiAgICAgICAgb3B0aW9ucy50YWdzID0gW3sgdGFnOiAnanNvbicsIG9wdGlvbjogJ29taXRlbXB0eScgfV1cbiAgICAgICAgY29uc3QgYXJncyA9IGdvbW9kaWZ5dGFncy5idWlsZEFyZ3MoZWRpdG9yLCBvcHRpb25zLCAnUmVtb3ZlJylcbiAgICAgICAgZXhwZWN0KGFyZ3MuaW5jbHVkZXMoJy1yZW1vdmUtdGFncycpKS50b0JlKGZhbHNlKVxuICAgICAgICBjb25zdCBpID0gYXJncy5pbmRleE9mKCctcmVtb3ZlLW9wdGlvbnMnKVxuICAgICAgICBleHBlY3QoaSkubm90LnRvQmUoLTEpXG4gICAgICAgIGV4cGVjdChhcmdzW2kgKyAxXSkudG9CZSgnanNvbj1vbWl0ZW1wdHknKVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ3doZW4gbW9kaWZ5aW5nIHRhZ3MnLCAoKSA9PiB7XG4gICAgICBpdCgnYWRkcyBqc29uIHRhZ3Mgd2l0aCBvcHRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDZdKVxuICAgICAgICBjb25zdCBjb21tYW5kID0gYXdhaXQgbGlmZWN5Y2xlLm1haW5Nb2R1bGVcbiAgICAgICAgICAucHJvdmlkZUdvQ29uZmlnKClcbiAgICAgICAgICAubG9jYXRvci5maW5kVG9vbCgnZ29tb2RpZnl0YWdzJylcbiAgICAgICAgZXhwZWN0KGNvbW1hbmQpLnRvQmVUcnV0aHkoKVxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdvbW9kaWZ5dGFncy5tb2RpZnlUYWdzKFxuICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0YWdzOiBbeyB0YWc6ICdqc29uJywgb3B0aW9uOiAnb21pdGVtcHR5JyB9XSxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NuYWtlY2FzZScsXG4gICAgICAgICAgICBzb3J0VGFnczogZmFsc2VcbiAgICAgICAgICB9LFxuICAgICAgICAgICdBZGQnLFxuICAgICAgICAgIGNvbW1hbmRcbiAgICAgICAgKVxuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSlcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHQuc3Rkb3V0KS50b0JlKFxuICAgICAgICAgICdwYWNrYWdlIGZvb1xcblxcbnR5cGUgQmFyIHN0cnVjdCB7XFxuXFx0UXVpY2tCcm93bkZveCBpbnQgICAgYGpzb246XCJxdWlja19icm93bl9mb3gsb21pdGVtcHR5XCJgXFxuXFx0TGF6eURvZyAgICAgICBzdHJpbmcgYGpzb246XCJsYXp5X2RvZyxvbWl0ZW1wdHlcImBcXG59XFxuXFxuJ1xuICAgICAgICApXG4gICAgICB9KVxuXG4gICAgICBpdCgncmV0dXJucyBhbiBlcnJvciBpZiB0aGUgY3Vyc29yIGlzIG5vdCBpbnNpZGUgYSBzdHJ1Y3QgZGVjbGFyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbMCwgMl0pXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBhd2FpdCBsaWZlY3ljbGUubWFpbk1vZHVsZVxuICAgICAgICAgIC5wcm92aWRlR29Db25maWcoKVxuICAgICAgICAgIC5sb2NhdG9yLmZpbmRUb29sKCdnb21vZGlmeXRhZ3MnKVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnb21vZGlmeXRhZ3MubW9kaWZ5VGFncyhcbiAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgeyB0YWdzOiBbXSB9LFxuICAgICAgICAgICdBZGQnLFxuICAgICAgICAgIGNvbW1hbmRcbiAgICAgICAgKVxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KClcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==