function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

/* eslint-env jasmine */

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _specHelpers = require('./../spec-helpers');

var _asyncSpecHelpers = require('../async-spec-helpers');

// eslint-disable-line

'use babel';describe('tester', function () {
  var tester = null;

  (0, _asyncSpecHelpers.beforeEach)(_asyncToGenerator(function* () {
    _specHelpers.lifecycle.setup();
    atom.config.set('go-plus.test.coverageHighlightMode', 'covered-and-uncovered');
    yield _specHelpers.lifecycle.activatePackage();
    var mainModule = _specHelpers.lifecycle.mainModule;

    tester = mainModule.loadTester();
  }));

  afterEach(function () {
    _specHelpers.lifecycle.teardown();
  });

  describe('go test args', function () {
    (0, _asyncSpecHelpers.beforeEach)(function () {
      atom.config.unset('go-plus.config.additionalTestArgs');
    });

    afterEach(function () {
      atom.config.set('go-plus.test.runTestsWithShortFlag', true);
      atom.config.set('go-plus.test.runTestsWithVerboseFlag', false);
    });

    (0, _asyncSpecHelpers.it)('uses the specified timeout', function () {
      var args = tester.buildGoTestArgs(10000, false);
      var foundTimeout = false;
      for (var arg of args) {
        if (arg.startsWith('-timeout')) {
          foundTimeout = true;
          expect(arg).toBe('-timeout=10000ms');
        }
      }
      expect(foundTimeout).toBe(true);
    });

    (0, _asyncSpecHelpers.it)('invokes the go test command with a coverprofile', function () {
      var args = tester.buildGoTestArgs(10000, true);
      expect(args[0]).toBe('test');
      expect(args[1].startsWith('-coverprofile=')).toBe(true);
    });

    describe('when specifying custom args', function () {
      (0, _asyncSpecHelpers.it)('prefers timeout from the custom args (if specified)', function () {
        atom.config.set('go-plus.config.additionalTestArgs', '-timeout=4000ms');
        var args = tester.buildGoTestArgs(8000, false);
        var foundTimeout = false;
        for (var arg of args) {
          if (arg.startsWith('-timeout')) {
            foundTimeout = true;
            expect(arg).toBe('-timeout=4000ms');
          }
        }
        expect(foundTimeout).toBe(true);
      });

      (0, _asyncSpecHelpers.it)('does not duplicate the -short or -verbose flags', function () {
        atom.config.set('go-plus.test.runTestsWithShortFlag', true);
        atom.config.set('go-plus.test.runTestsWithVerboseFlag', true);
        atom.config.set('go-plus.config.additionalTestArgs', '-short -verbose');

        var args = tester.buildGoTestArgs();
        var shortFlags = args.filter(function (a) {
          return a === '-short';
        }).length;
        var verboseFlags = args.filter(function (a) {
          return a === '-v';
        }).length;

        expect(shortFlags).toBe(1);
        expect(verboseFlags).toBe(1);
      });

      (0, _asyncSpecHelpers.it)('handles args with spaces', function () {
        atom.config.set('go-plus.config.additionalTestArgs', '-myarg="hello world"  -arg2   3');
        var args = tester.buildGoTestArgs();
        expect(args.length).toBeGreaterThan(3);
        expect(args[1]).toEqual('-myarg=hello world');
        expect(args[2]).toEqual('-arg2');
        expect(args[3]).toEqual('3');
      });
    });
  });

  describe('with a gopath setup', function () {
    var gopath = null;
    var filePath = undefined;
    var editor = undefined;

    (0, _asyncSpecHelpers.beforeEach)(_asyncToGenerator(function* () {
      gopath = _path2['default'].join(__dirname, '..', 'fixtures', 'test');
      process.env.GOPATH = gopath;
      atom.project.setPaths([gopath]);

      filePath = _path2['default'].join(gopath, 'src', 'github.com', 'testuser', 'example', 'go-plus.go');

      editor = yield atom.workspace.open(filePath);
    }));

    describe('when run tests on save is enabled, but compile on save is disabled', function () {
      (0, _asyncSpecHelpers.beforeEach)(function () {
        atom.config.set('go-plus.config.compileOnSave', false);
        atom.config.set('go-plus.test.runTestsOnSave', true);
        atom.config.set('go-plus.test.runTestsWithCoverage', false);
      });

      (0, _asyncSpecHelpers.it)('runs tests', _asyncToGenerator(function* () {
        spyOn(tester, 'runTests').andCallThrough();
        yield tester.handleSaveEvent(editor);
        expect(tester.runTests).toHaveBeenCalled();
      }));

      (0, _asyncSpecHelpers.it)('updates the busy signal', _asyncToGenerator(function* () {
        var fake = function fake(title, promiseFunc) {
          return promiseFunc();
        };
        var reportBusySpy = jasmine.createSpy('reportBusyWhile').andCallFake(fake);
        spyOn(tester, 'busySignal').andReturn({
          reportBusyWhile: reportBusySpy
        });
        yield tester.handleSaveEvent(editor);
        expect(reportBusySpy.calls.length).toEqual(1);
      }));
    });

    describe('when run tests on save is disabled', function () {
      (0, _asyncSpecHelpers.beforeEach)(function () {
        atom.config.set('go-plus.test.runTestsOnSave', false);
      });

      (0, _asyncSpecHelpers.it)('does not run tests automatically on save', _asyncToGenerator(function* () {
        spyOn(tester, 'runTests');
        yield tester.handleSaveEvent(editor);
        expect(tester.runTests).not.toHaveBeenCalled();
      }));

      (0, _asyncSpecHelpers.it)('displays coverage for go source', _asyncToGenerator(function* () {
        yield tester.runTests(editor);

        var layers = tester.markedEditors.get(editor.id);
        expect(layers).toBeTruthy();
        var layerids = layers.split(',');
        var coveredLayer = editor.getMarkerLayer(layerids[0]);
        var uncoveredLayer = editor.getMarkerLayer(layerids[1]);
        expect(coveredLayer).toBeTruthy();
        expect(uncoveredLayer).toBeTruthy();

        var coveredmarkers = coveredLayer.getMarkers();
        expect(coveredmarkers).toBeDefined();
        expect(coveredmarkers.length).toBe(1);
        expect(coveredmarkers[0]).toBeDefined();
        var range = coveredmarkers[0].getBufferRange();
        expect(range.start.row).toBe(8);
        expect(range.start.column).toBe(20);
        expect(range.end.row).toBe(10);
        expect(range.end.column).toBe(1);

        var uncoveredmarkers = uncoveredLayer.getMarkers();
        expect(uncoveredmarkers).toBeDefined();
        expect(uncoveredmarkers.length).toBe(1);
        expect(uncoveredmarkers[0]).toBeDefined();
        range = uncoveredmarkers[0].getBufferRange();
        expect(range).toBeDefined();
        expect(range.start.row).toBe(4);
        expect(range.start.column).toBe(12);
        expect(range.end.row).toBe(6);
        expect(range.end.column).toBe(1);
      }));

      (0, _asyncSpecHelpers.it)('clears coverage for go source', _asyncToGenerator(function* () {
        yield tester.runTests(editor);

        var layerids = tester.markedEditors.get(editor.id).split(',');
        var coveredLayer = editor.getMarkerLayer(layerids[0]);
        var uncoveredLayer = editor.getMarkerLayer(layerids[1]);
        expect(coveredLayer).toBeTruthy();
        expect(uncoveredLayer).toBeTruthy();

        var coveredmarkers = coveredLayer.getMarkers();
        expect(coveredmarkers).toBeDefined();
        expect(coveredmarkers.length).toBe(1);
        expect(coveredmarkers[0]).toBeDefined();
        var range = coveredmarkers[0].getBufferRange();
        expect(range.start.row).toBe(8);
        expect(range.start.column).toBe(20);
        expect(range.end.row).toBe(10);
        expect(range.end.column).toBe(1);

        var uncoveredmarkers = uncoveredLayer.getMarkers();
        expect(uncoveredmarkers).toBeDefined();
        expect(uncoveredmarkers.length).toBe(1);
        expect(uncoveredmarkers[0]).toBeDefined();
        range = uncoveredmarkers[0].getBufferRange();
        expect(range).toBeDefined();
        expect(range.start.row).toBe(4);
        expect(range.start.column).toBe(12);
        expect(range.end.row).toBe(6);
        expect(range.end.column).toBe(1);

        tester.clearMarkers(editor);
        expect(coveredLayer.getMarkers().length).toBe(0);
        expect(uncoveredLayer.getMarkers().length).toBe(0);
      }));
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLXBsdXMvc3BlYy90ZXN0L3Rlc3Rlci1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFHaUIsTUFBTTs7OzsyQkFDRyxtQkFBbUI7O2dDQUNHLHVCQUF1Qjs7OztBQUx2RSxXQUFXLENBQUEsQUFPWCxRQUFRLENBQUMsUUFBUSxFQUFFLFlBQU07QUFDdkIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBOztBQUVqQixzREFBVyxhQUFZO0FBQ3JCLDJCQUFVLEtBQUssRUFBRSxDQUFBO0FBQ2pCLFFBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLG9DQUFvQyxFQUNwQyx1QkFBdUIsQ0FDeEIsQ0FBQTtBQUNELFVBQU0sdUJBQVUsZUFBZSxFQUFFLENBQUE7UUFDekIsVUFBVSwwQkFBVixVQUFVOztBQUNsQixVQUFNLEdBQUcsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFBO0dBQ2pDLEVBQUMsQ0FBQTs7QUFFRixXQUFTLENBQUMsWUFBTTtBQUNkLDJCQUFVLFFBQVEsRUFBRSxDQUFBO0dBQ3JCLENBQUMsQ0FBQTs7QUFFRixVQUFRLENBQUMsY0FBYyxFQUFFLFlBQU07QUFDN0Isc0NBQVcsWUFBTTtBQUNmLFVBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUE7S0FDdkQsQ0FBQyxDQUFBOztBQUVGLGFBQVMsQ0FBQyxZQUFNO0FBQ2QsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsb0NBQW9DLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDM0QsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsc0NBQXNDLEVBQUUsS0FBSyxDQUFDLENBQUE7S0FDL0QsQ0FBQyxDQUFBOztBQUVGLDhCQUFHLDRCQUE0QixFQUFFLFlBQU07QUFDckMsVUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFD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QUMsQ0FBQTtBQUMzQixjQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNoRCxjQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtPQUNuRCxFQUFDLENBQUE7S0FDSCxDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL2hvbWUvbXl1Z2EvLmF0b20vcGFja2FnZXMvZ28tcGx1cy9zcGVjL3Rlc3QvdGVzdGVyLXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJ1xuLyogZXNsaW50LWVudiBqYXNtaW5lICovXG5cbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgeyBsaWZlY3ljbGUgfSBmcm9tICcuLy4uL3NwZWMtaGVscGVycydcbmltcG9ydCB7IGl0LCBmaXQsIGZmaXQsIGJlZm9yZUVhY2gsIHJ1bnMgfSBmcm9tICcuLi9hc3luYy1zcGVjLWhlbHBlcnMnIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuZGVzY3JpYmUoJ3Rlc3RlcicsICgpID0+IHtcbiAgbGV0IHRlc3RlciA9IG51bGxcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBsaWZlY3ljbGUuc2V0dXAoKVxuICAgIGF0b20uY29uZmlnLnNldChcbiAgICAgICdnby1wbHVzLnRlc3QuY292ZXJhZ2VIaWdobGlnaHRNb2RlJyxcbiAgICAgICdjb3ZlcmVkLWFuZC11bmNvdmVyZWQnXG4gICAgKVxuICAgIGF3YWl0IGxpZmVjeWNsZS5hY3RpdmF0ZVBhY2thZ2UoKVxuICAgIGNvbnN0IHsgbWFpbk1vZHVsZSB9ID0gbGlmZWN5Y2xlXG4gICAgdGVzdGVyID0gbWFpbk1vZHVsZS5sb2FkVGVzdGVyKClcbiAgfSlcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGxpZmVjeWNsZS50ZWFyZG93bigpXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2dvIHRlc3QgYXJncycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGF0b20uY29uZmlnLnVuc2V0KCdnby1wbHVzLmNvbmZpZy5hZGRpdGlvbmFsVGVzdEFyZ3MnKVxuICAgIH0pXG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgYXRvbS5jb25maWcuc2V0KCdnby1wbHVzLnRlc3QucnVuVGVzdHNXaXRoU2hvcnRGbGFnJywgdHJ1ZSlcbiAgICAgIGF0b20uY29uZmlnLnNldCgnZ28tcGx1cy50ZXN0LnJ1blRlc3RzV2l0aFZlcmJvc2VGbGFnJywgZmFsc2UpXG4gICAgfSlcblxuICAgIGl0KCd1c2VzIHRoZSBzcGVjaWZpZWQgdGltZW91dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFyZ3MgPSB0ZXN0ZXIuYnVpbGRHb1Rlc3RBcmdzKDEwMDAwLCBmYWxzZSlcbiAgICAgIGxldCBmb3VuZFRpbWVvdXQgPSBmYWxzZVxuICAgICAgZm9yIChjb25zdCBhcmcgb2YgYXJncykge1xuICAgICAgICBpZiAoYXJnLnN0YXJ0c1dpdGgoJy10aW1lb3V0JykpIHtcbiAgICAgICAgICBmb3VuZFRpbWVvdXQgPSB0cnVlXG4gICAgICAgICAgZXhwZWN0KGFyZykudG9CZSgnLXRpbWVvdXQ9MTAwMDBtcycpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGV4cGVjdChmb3VuZFRpbWVvdXQpLnRvQmUodHJ1ZSlcbiAgICB9KVxuXG4gICAgaXQoJ2ludm9rZXMgdGhlIGdvIHRlc3QgY29tbWFuZCB3aXRoIGEgY292ZXJwcm9maWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXJncyA9IHRlc3Rlci5idWlsZEdvVGVzdEFyZ3MoMTAwMDAsIHRydWUpXG4gICAgICBleHBlY3QoYXJnc1swXSkudG9CZSgndGVzdCcpXG4gICAgICBleHBlY3QoYXJnc1sxXS5zdGFydHNXaXRoKCctY292ZXJwcm9maWxlPScpKS50b0JlKHRydWUpXG4gICAgfSlcblxuICAgIGRlc2NyaWJlKCd3aGVuIHNwZWNpZnlpbmcgY3VzdG9tIGFyZ3MnLCAoKSA9PiB7XG4gICAgICBpdCgncHJlZmVycyB0aW1lb3V0IGZyb20gdGhlIGN1c3RvbSBhcmdzIChpZiBzcGVjaWZpZWQpJywgKCkgPT4ge1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoJ2dvLXBsdXMuY29uZmlnLmFkZGl0aW9uYWxUZXN0QXJncycsICctdGltZW91dD00MDAwbXMnKVxuICAgICAgICBjb25zdCBhcmdzID0gdGVzdGVyLmJ1aWxkR29UZXN0QXJncyg4MDAwLCBmYWxzZSlcbiAgICAgICAgbGV0IGZvdW5kVGltZW91dCA9IGZhbHNlXG4gICAgICAgIGZvciAoY29uc3QgYXJnIG9mIGFyZ3MpIHtcbiAgICAgICAgICBpZiAoYXJnLnN0YXJ0c1dpdGgoJy10aW1lb3V0JykpIHtcbiAgICAgICAgICAgIGZvdW5kVGltZW91dCA9IHRydWVcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvQmUoJy10aW1lb3V0PTQwMDBtcycpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGV4cGVjdChmb3VuZFRpbWVvdXQpLnRvQmUodHJ1ZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdkb2VzIG5vdCBkdXBsaWNhdGUgdGhlIC1zaG9ydCBvciAtdmVyYm9zZSBmbGFncycsICgpID0+IHtcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KCdnby1wbHVzLnRlc3QucnVuVGVzdHNXaXRoU2hvcnRGbGFnJywgdHJ1ZSlcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KCdnby1wbHVzLnRlc3QucnVuVGVzdHNXaXRoVmVyYm9zZUZsYWcnLCB0cnVlKVxuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoJ2dvLXBsdXMuY29uZmlnLmFkZGl0aW9uYWxUZXN0QXJncycsICctc2hvcnQgLXZlcmJvc2UnKVxuXG4gICAgICAgIGNvbnN0IGFyZ3MgPSB0ZXN0ZXIuYnVpbGRHb1Rlc3RBcmdzKClcbiAgICAgICAgY29uc3Qgc2hvcnRGbGFncyA9IGFyZ3MuZmlsdGVyKGEgPT4gYSA9PT0gJy1zaG9ydCcpLmxlbmd0aFxuICAgICAgICBjb25zdCB2ZXJib3NlRmxhZ3MgPSBhcmdzLmZpbHRlcihhID0+IGEgPT09ICctdicpLmxlbmd0aFxuXG4gICAgICAgIGV4cGVjdChzaG9ydEZsYWdzKS50b0JlKDEpXG4gICAgICAgIGV4cGVjdCh2ZXJib3NlRmxhZ3MpLnRvQmUoMSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdoYW5kbGVzIGFyZ3Mgd2l0aCBzcGFjZXMnLCAoKSA9PiB7XG4gICAgICAgIGF0b20uY29uZmlnLnNldChcbiAgICAgICAgICAnZ28tcGx1cy5jb25maWcuYWRkaXRpb25hbFRlc3RBcmdzJyxcbiAgICAgICAgICAnLW15YXJnPVwiaGVsbG8gd29ybGRcIiAgLWFyZzIgICAzJ1xuICAgICAgICApXG4gICAgICAgIGNvbnN0IGFyZ3MgPSB0ZXN0ZXIuYnVpbGRHb1Rlc3RBcmdzKClcbiAgICAgICAgZXhwZWN0KGFyZ3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMylcbiAgICAgICAgZXhwZWN0KGFyZ3NbMV0pLnRvRXF1YWwoJy1teWFyZz1oZWxsbyB3b3JsZCcpXG4gICAgICAgIGV4cGVjdChhcmdzWzJdKS50b0VxdWFsKCctYXJnMicpXG4gICAgICAgIGV4cGVjdChhcmdzWzNdKS50b0VxdWFsKCczJylcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnd2l0aCBhIGdvcGF0aCBzZXR1cCcsICgpID0+IHtcbiAgICBsZXQgZ29wYXRoID0gbnVsbFxuICAgIGxldCBmaWxlUGF0aFxuICAgIGxldCBlZGl0b3JcblxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZ29wYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ2ZpeHR1cmVzJywgJ3Rlc3QnKVxuICAgICAgcHJvY2Vzcy5lbnYuR09QQVRIID0gZ29wYXRoXG4gICAgICBhdG9tLnByb2plY3Quc2V0UGF0aHMoW2dvcGF0aF0pXG5cbiAgICAgIGZpbGVQYXRoID0gcGF0aC5qb2luKFxuICAgICAgICBnb3BhdGgsXG4gICAgICAgICdzcmMnLFxuICAgICAgICAnZ2l0aHViLmNvbScsXG4gICAgICAgICd0ZXN0dXNlcicsXG4gICAgICAgICdleGFtcGxlJyxcbiAgICAgICAgJ2dvLXBsdXMuZ28nXG4gICAgICApXG5cbiAgICAgIGVkaXRvciA9IGF3YWl0IGF0b20ud29ya3NwYWNlLm9wZW4oZmlsZVBhdGgpXG4gICAgfSlcblxuICAgIGRlc2NyaWJlKCd3aGVuIHJ1biB0ZXN0cyBvbiBzYXZlIGlzIGVuYWJsZWQsIGJ1dCBjb21waWxlIG9uIHNhdmUgaXMgZGlzYWJsZWQnLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KCdnby1wbHVzLmNvbmZpZy5jb21waWxlT25TYXZlJywgZmFsc2UpXG4gICAgICAgIGF0b20uY29uZmlnLnNldCgnZ28tcGx1cy50ZXN0LnJ1blRlc3RzT25TYXZlJywgdHJ1ZSlcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KCdnby1wbHVzLnRlc3QucnVuVGVzdHNXaXRoQ292ZXJhZ2UnLCBmYWxzZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdydW5zIHRlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBzcHlPbih0ZXN0ZXIsICdydW5UZXN0cycpLmFuZENhbGxUaHJvdWdoKClcbiAgICAgICAgYXdhaXQgdGVzdGVyLmhhbmRsZVNhdmVFdmVudChlZGl0b3IpXG4gICAgICAgIGV4cGVjdCh0ZXN0ZXIucnVuVGVzdHMpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgfSlcblxuICAgICAgaXQoJ3VwZGF0ZXMgdGhlIGJ1c3kgc2lnbmFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBmYWtlID0gKHRpdGxlLCBwcm9taXNlRnVuYykgPT4gcHJvbWlzZUZ1bmMoKVxuICAgICAgICBjb25zdCByZXBvcnRCdXN5U3B5ID0gamFzbWluZVxuICAgICAgICAgIC5jcmVhdGVTcHkoJ3JlcG9ydEJ1c3lXaGlsZScpXG4gICAgICAgICAgLmFuZENhbGxGYWtlKGZha2UpXG4gICAgICAgIHNweU9uKHRlc3RlciwgJ2J1c3lTaWduYWwnKS5hbmRSZXR1cm4oe1xuICAgICAgICAgIHJlcG9ydEJ1c3lXaGlsZTogcmVwb3J0QnVzeVNweVxuICAgICAgICB9KVxuICAgICAgICBhd2FpdCB0ZXN0ZXIuaGFuZGxlU2F2ZUV2ZW50KGVkaXRvcilcbiAgICAgICAgZXhwZWN0KHJlcG9ydEJ1c3lTcHkuY2FsbHMubGVuZ3RoKS50b0VxdWFsKDEpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnd2hlbiBydW4gdGVzdHMgb24gc2F2ZSBpcyBkaXNhYmxlZCcsICgpID0+IHtcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoJ2dvLXBsdXMudGVzdC5ydW5UZXN0c09uU2F2ZScsIGZhbHNlKVxuICAgICAgfSlcblxuICAgICAgaXQoJ2RvZXMgbm90IHJ1biB0ZXN0cyBhdXRvbWF0aWNhbGx5IG9uIHNhdmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHNweU9uKHRlc3RlciwgJ3J1blRlc3RzJylcbiAgICAgICAgYXdhaXQgdGVzdGVyLmhhbmRsZVNhdmVFdmVudChlZGl0b3IpXG4gICAgICAgIGV4cGVjdCh0ZXN0ZXIucnVuVGVzdHMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdkaXNwbGF5cyBjb3ZlcmFnZSBmb3IgZ28gc291cmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0ZXN0ZXIucnVuVGVzdHMoZWRpdG9yKVxuXG4gICAgICAgIGNvbnN0IGxheWVycyA9IHRlc3Rlci5tYXJrZWRFZGl0b3JzLmdldChlZGl0b3IuaWQpXG4gICAgICAgIGV4cGVjdChsYXllcnMpLnRvQmVUcnV0aHkoKVxuICAgICAgICBsZXQgbGF5ZXJpZHMgPSBsYXllcnMuc3BsaXQoJywnKVxuICAgICAgICBsZXQgY292ZXJlZExheWVyID0gZWRpdG9yLmdldE1hcmtlckxheWVyKGxheWVyaWRzWzBdKVxuICAgICAgICBsZXQgdW5jb3ZlcmVkTGF5ZXIgPSBlZGl0b3IuZ2V0TWFya2VyTGF5ZXIobGF5ZXJpZHNbMV0pXG4gICAgICAgIGV4cGVjdChjb3ZlcmVkTGF5ZXIpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3QodW5jb3ZlcmVkTGF5ZXIpLnRvQmVUcnV0aHkoKVxuXG4gICAgICAgIGxldCBjb3ZlcmVkbWFya2VycyA9IGNvdmVyZWRMYXllci5nZXRNYXJrZXJzKClcbiAgICAgICAgZXhwZWN0KGNvdmVyZWRtYXJrZXJzKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChjb3ZlcmVkbWFya2Vycy5sZW5ndGgpLnRvQmUoMSlcbiAgICAgICAgZXhwZWN0KGNvdmVyZWRtYXJrZXJzWzBdKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGxldCByYW5nZSA9IGNvdmVyZWRtYXJrZXJzWzBdLmdldEJ1ZmZlclJhbmdlKClcbiAgICAgICAgZXhwZWN0KHJhbmdlLnN0YXJ0LnJvdykudG9CZSg4KVxuICAgICAgICBleHBlY3QocmFuZ2Uuc3RhcnQuY29sdW1uKS50b0JlKDIwKVxuICAgICAgICBleHBlY3QocmFuZ2UuZW5kLnJvdykudG9CZSgxMClcbiAgICAgICAgZXhwZWN0KHJhbmdlLmVuZC5jb2x1bW4pLnRvQmUoMSlcblxuICAgICAgICBsZXQgdW5jb3ZlcmVkbWFya2VycyA9IHVuY292ZXJlZExheWVyLmdldE1hcmtlcnMoKVxuICAgICAgICBleHBlY3QodW5jb3ZlcmVkbWFya2VycykudG9CZURlZmluZWQoKVxuICAgICAgICBleHBlY3QodW5jb3ZlcmVkbWFya2Vycy5sZW5ndGgpLnRvQmUoMSlcbiAgICAgICAgZXhwZWN0KHVuY292ZXJlZG1hcmtlcnNbMF0pLnRvQmVEZWZpbmVkKClcbiAgICAgICAgcmFuZ2UgPSB1bmNvdmVyZWRtYXJrZXJzWzBdLmdldEJ1ZmZlclJhbmdlKClcbiAgICAgICAgZXhwZWN0KHJhbmdlKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChyYW5nZS5zdGFydC5yb3cpLnRvQmUoNClcbiAgICAgICAgZXhwZWN0KHJhbmdlLnN0YXJ0LmNvbHVtbikudG9CZSgxMilcbiAgICAgICAgZXhwZWN0KHJhbmdlLmVuZC5yb3cpLnRvQmUoNilcbiAgICAgICAgZXhwZWN0KHJhbmdlLmVuZC5jb2x1bW4pLnRvQmUoMSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdjbGVhcnMgY292ZXJhZ2UgZm9yIGdvIHNvdXJjZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGVzdGVyLnJ1blRlc3RzKGVkaXRvcilcblxuICAgICAgICBsZXQgbGF5ZXJpZHMgPSB0ZXN0ZXIubWFya2VkRWRpdG9ycy5nZXQoZWRpdG9yLmlkKS5zcGxpdCgnLCcpXG4gICAgICAgIGxldCBjb3ZlcmVkTGF5ZXIgPSBlZGl0b3IuZ2V0TWFya2VyTGF5ZXIobGF5ZXJpZHNbMF0pXG4gICAgICAgIGxldCB1bmNvdmVyZWRMYXllciA9IGVkaXRvci5nZXRNYXJrZXJMYXllcihsYXllcmlkc1sxXSlcbiAgICAgICAgZXhwZWN0KGNvdmVyZWRMYXllcikudG9CZVRydXRoeSgpXG4gICAgICAgIGV4cGVjdCh1bmNvdmVyZWRMYXllcikudG9CZVRydXRoeSgpXG5cbiAgICAgICAgbGV0IGNvdmVyZWRtYXJrZXJzID0gY292ZXJlZExheWVyLmdldE1hcmtlcnMoKVxuICAgICAgICBleHBlY3QoY292ZXJlZG1hcmtlcnMpLnRvQmVEZWZpbmVkKClcbiAgICAgICAgZXhwZWN0KGNvdmVyZWRtYXJrZXJzLmxlbmd0aCkudG9CZSgxKVxuICAgICAgICBleHBlY3QoY292ZXJlZG1hcmtlcnNbMF0pLnRvQmVEZWZpbmVkKClcbiAgICAgICAgbGV0IHJhbmdlID0gY292ZXJlZG1hcmtlcnNbMF0uZ2V0QnVmZmVyUmFuZ2UoKVxuICAgICAgICBleHBlY3QocmFuZ2Uuc3RhcnQucm93KS50b0JlKDgpXG4gICAgICAgIGV4cGVjdChyYW5nZS5zdGFydC5jb2x1bW4pLnRvQmUoMjApXG4gICAgICAgIGV4cGVjdChyYW5nZS5lbmQucm93KS50b0JlKDEwKVxuICAgICAgICBleHBlY3QocmFuZ2UuZW5kLmNvbHVtbikudG9CZSgxKVxuXG4gICAgICAgIGxldCB1bmNvdmVyZWRtYXJrZXJzID0gdW5jb3ZlcmVkTGF5ZXIuZ2V0TWFya2VycygpXG4gICAgICAgIGV4cGVjdCh1bmNvdmVyZWRtYXJrZXJzKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdCh1bmNvdmVyZWRtYXJrZXJzLmxlbmd0aCkudG9CZSgxKVxuICAgICAgICBleHBlY3QodW5jb3ZlcmVkbWFya2Vyc1swXSkudG9CZURlZmluZWQoKVxuICAgICAgICByYW5nZSA9IHVuY292ZXJlZG1hcmtlcnNbMF0uZ2V0QnVmZmVyUmFuZ2UoKVxuICAgICAgICBleHBlY3QocmFuZ2UpLnRvQmVEZWZpbmVkKClcbiAgICAgICAgZXhwZWN0KHJhbmdlLnN0YXJ0LnJvdykudG9CZSg0KVxuICAgICAgICBleHBlY3QocmFuZ2Uuc3RhcnQuY29sdW1uKS50b0JlKDEyKVxuICAgICAgICBleHBlY3QocmFuZ2UuZW5kLnJvdykudG9CZSg2KVxuICAgICAgICBleHBlY3QocmFuZ2UuZW5kLmNvbHVtbikudG9CZSgxKVxuXG4gICAgICAgIHRlc3Rlci5jbGVhck1hcmtlcnMoZWRpdG9yKVxuICAgICAgICBleHBlY3QoY292ZXJlZExheWVyLmdldE1hcmtlcnMoKS5sZW5ndGgpLnRvQmUoMClcbiAgICAgICAgZXhwZWN0KHVuY292ZXJlZExheWVyLmdldE1hcmtlcnMoKS5sZW5ndGgpLnRvQmUoMClcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=