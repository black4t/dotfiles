'use babel';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.create = create;
exports.createError = createError;

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function create(rawVariables) {
  var variables = {};

  function addVariable(parentPath, variable) {
    var path = pathJoin(parentPath, variable.path);
    var children = variable.children;

    variables[path] = {
      name: variable.name,
      loaded: true,
      hasChildren: children ? !!children.length : false,
      value: variable.value,
      parentPath: parentPath,
      type: variable.kind
    };
    if (children) {
      children.forEach(function (v) {
        addVariable(path, v);
      });
    }
  }

  rawVariables.forEach(function (variable) {
    var v = factory.variable(variable, true);
    v.path = v.name = variable.name;
    addVariable('', v);
  });

  return variables;
}

function createError(message) {
  var name = arguments.length <= 1 || arguments[1] === undefined ? 'err' : arguments[1];

  return _defineProperty({}, name, {
    name: name,
    loaded: true,
    hasChildren: false,
    value: formatString(message),
    parentPath: '',
    type: 'interface'
  });
}

function pathJoin() {
  for (var _len = arguments.length, items = Array(_len), _key = 0; _key < _len; _key++) {
    items[_key] = arguments[_key];
  }

  return items.filter(function (i) {
    return i !== '';
  }).join('.');
}

var factory = {
  variable: function variable(_variable, top) {
    var kind = KINDS[_variable.kind];
    if (_variable.unreadable !== '') {
      return { value: '(unreadable ' + _variable.unreadable + ')', kind: kind };
    }

    if (!_variable.value && _variable.addr === 0 && !top) {
      return { value: [shortType(_variable.type), nil()], kind: kind };
    }

    if (kind.startsWith('complex')) {
      kind = 'complex';
    } else if (!factory[kind]) {
      kind = 'default';
    }
    var v = factory[kind](_variable);
    v.kind = kind;
    return v;
  },
  array: function array(variable) {
    return factory.slice(variable);
  },
  slice: function slice(variable) {
    var children = variable.children.map(function (c, i) {
      var _factory$variable = factory.variable(c);

      var value = _factory$variable.value;
      var children = _factory$variable.children;

      return { path: i, name: formatNumber(i), value: value, children: children };
    });

    var diff = variable.len - variable.children.length;
    if (diff > 0) {
      children.push({ path: 'more', name: '... +' + diff + ' more' });
    }

    var kind = KINDS[variable.kind];
    var typeInfo = kind === 'slice' && ['(len: ', formatNumber(variable.len), ', cap: ', formatNumber(variable.cap), ')'];
    return {
      value: [shortType(variable.type), typeInfo],
      children: children
    };
  },
  ptr: function ptr(variable) {
    var child = variable.children[0];
    if (!child) {
      return { value: nil() };
    }

    if (variable.type === '') {
      return { value: nil() };
    }

    if (child.onlyAddr) {
      return {
        value: ['(', shortType(variable.type), ')(', formatAddr(child), ')']
      };
    }

    var _factory$variable2 = factory.variable(child);

    var value = _factory$variable2.value;
    var children = _factory$variable2.children;

    return {
      value: ['*', value],
      children: children
    };
  },
  unsafePointer: function unsafePointer(variable) {
    return {
      value: ['unsafe.Pointer(', formatAddr(variable.children[0]), ')']
    };
  },
  string: function string(variable) {
    return formatString(variable.value, variable.len - variable.value.length);
  },
  chan: function chan(variable) {
    // could also be rendered as struct
    // return factory.struct(variable)

    var content = undefined;
    if (variable.children.length === 0) {
      content = nil();
    } else {
      var c0 = factory.variable(variable.children[0]);
      var c1 = factory.variable(variable.children[1]);
      if (c0.children) {
        console.log(variable.children[0]);
      }
      if (c1.children) {
        console.log(variable.children[1]);
      }
      content = [' ', c0.value, '/', c1.value];
    }
    return {
      value: [shortType(variable.type), content]
    };
  },
  struct: function struct(variable) {
    var type = shortType(variable.type);
    var diff = variable.len - variable.children.length;
    if (diff > 0) {
      return {
        value: [type && ['(*', type, ')'], '(', formatAddr(variable), ')']
      };
    }

    var children = variable.children.map(function (c) {
      var _factory$variable3 = factory.variable(c);

      var value = _factory$variable3.value;
      var children = _factory$variable3.children;

      return { path: c.name, name: c.name, value: value, children: children };
    });
    return {
      value: type,
      children: children
    };
  },
  'interface': function _interface(variable) {
    var child = variable.children[0];
    if (child.kind === 0 && child.addr === 0) {
      return {
        value: [shortType(variable.type), nil()]
      };
    }

    // nicer handling for errors
    if (variable.type === 'error' && child.type === '*errors.errorString') {
      var c = child.children[0];
      if (c) {
        var err = c.children[0];
        if (err) {
          return {
            value: ['error ', factory.variable(err).value]
          };
        }
      }
      return {
        value: ['error(', formatAddr(child), ')']
      };
    }

    var _factory$variable4 = factory.variable(child);

    var value = _factory$variable4.value;
    var children = _factory$variable4.children;

    return {
      value: [shortType(variable.type), ' (', value, ')'],
      children: children
    };
  },
  map: function map(variable) {
    var children = [];
    for (var i = 0; i < variable.children.length; i += 2) {
      var _factory$variable5 = factory.variable(variable.children[i]);

      var kv = _factory$variable5.value;
      var kc = _factory$variable5.children;

      var _factory$variable6 = factory.variable(variable.children[i + 1]);

      var vv = _factory$variable6.value;
      var vc = _factory$variable6.children;

      if (!kc && !vc) {
        children.push({ path: i, name: kv, value: vv });
      } else if (!kc) {
        children.push({
          path: i,
          name: kv,
          value: vv,
          children: vc
        });
      } else {
        children.push({
          path: i,
          name: '{ key, value }',
          children: [{ path: 'key', name: 'key', value: kv, children: kc }, { path: 'value', name: 'value', value: vv, children: vc }]
        });
      }
    }

    var diff = variable.len - variable.children.length / 2;
    if (diff > 0) {
      children.push({ path: 'more', name: '... +' + diff + ' more' });
    }

    return {
      value: shortType(variable.type),
      children: children
    };
  },
  func: function func(variable) {
    return {
      value: variable.value ? shortType(variable.value) : nil()
    };
  },
  complex: function complex(variable) {
    var _factory$variable7 = factory.variable(variable.children[0]);

    var v0 = _factory$variable7.value;

    var _factory$variable8 = factory.variable(variable.children[1]);

    var v1 = _factory$variable8.value;

    return { value: ['(', v0, ' + ', v1, 'i)'] };
  },
  'default': function _default(variable) {
    var kind = KINDS[variable.kind];
    var className = undefined;
    if (variable.value) {
      if (kind.match(NUMERIC_REGEX)) {
        className = 'syntax--constant syntax--numeric constant numeric';
      } else if (kind === 'bool') {
        className = 'syntax--constant syntax--language language';
      }
    }
    return {
      value: { className: className, value: variable.value || '(unknown ' + KINDS[variable.kind] + ')' }
    };
  }
};

var NUMERIC_REGEX = /^(u)?(int|float)/;
var KINDS = ['invalid', 'bool', 'int', 'int8', 'int16', 'int32', 'int64', 'uint', 'uint8', 'uint16', 'uint32', 'uint64', 'uintptr', 'float32', 'float64', 'complex64', 'complex128', 'array', 'chan', 'func', 'interface', 'map', 'ptr', 'slice', 'string', 'struct', 'unsafePointer'
// total: 27...
];

function shortType(type) {
  if (!type) {
    return '';
  }
  if (type.startsWith('map[')) {
    var parts = type.split(']');
    if (parts.length > 2) {
      // TODO: this does not work for complex types
      // "map[float32]map[int]string"
      // "map[string][2]int32"
      // "map[string]func(*net/http.Server, *crypto/tls.Conn, net/http.Handler)"
      // "map[string]map[string]github.com/nicksnyder/go-i18n/i18n/translation.Translation"
      // "map[net/http.http2FrameType]map[net/http.http2Flags]string"
      return type;
    }
    return ['map[', shortType(parts[0].substr(4)), ']', shortType(parts[1])];
  }
  if (type.startsWith('struct ')) {
    type = type.substr('struct '.length);
  }
  var t = '';
  if (type.startsWith('[')) {
    var closingIndex = type.indexOf(']');
    if (closingIndex >= 0) {
      closingIndex++;
      t = type.substring(0, closingIndex);
      type = type.substring(closingIndex);
    }
  }
  if (type.startsWith('*')) {
    t += '*';
    type = type.substring(1);
  }
  t += type.split('/').pop();
  return t;
}
function nil() {
  return { value: ' nil', className: 'syntax--constant syntax--language constant language' };
}
function formatString(value) {
  var more = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];

  return {
    value: {
      value: ['"' + value + '"', more > 0 ? '... +' + more + ' more' : null],
      className: 'syntax--string string'
    }
  };
}
function formatNumber(value) {
  return { value: value, className: 'syntax--constant syntax--numeric constant numeric' };
}
function formatAddr(variable) {
  return formatNumber('0x' + variable.addr.toString(16));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2dvLWRlYnVnL2xpYi9kZWx2ZS12YXJpYWJsZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFBOzs7Ozs7Ozs7O0FBRUosU0FBUyxNQUFNLENBQUUsWUFBWSxFQUFFO0FBQ3BDLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQTs7QUFFcEIsV0FBUyxXQUFXLENBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRTtBQUMxQyxRQUFNLElBQUksR0FBRyxRQUFRLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUN4QyxRQUFRLEdBQUssUUFBUSxDQUFyQixRQUFROztBQUNoQixhQUFTLENBQUMsSUFBSSxDQUFDLEdBQUc7QUFDaEIsVUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJO0FBQ25CLFlBQU0sRUFBRSxJQUFJO0FBQ1osaUJBQVcsRUFBRSxRQUFRLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsS0FBSztBQUNqRCxXQUFLLEVBQUUsUUFBUSxDQUFDLEtBQUs7QUFDckIsZ0JBQVUsRUFBVixVQUFVO0FBQ1YsVUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJO0tBQ3BCLENBQUE7QUFDRCxRQUFJLFFBQVEsRUFBRTtBQUNaLGNBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFDLEVBQUs7QUFDdEIsbUJBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7T0FDckIsQ0FBQyxDQUFBO0tBQ0g7R0FDRjs7QUFFRCxjQUFZLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBUSxFQUFLO0FBQ2pDLFFBQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzFDLEtBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFBO0FBQy9CLGVBQVcsQ0FBQyxFQUFFLEVBQUUs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QUFJLENBQ3RDO0FBQ0QsZUFBUyxFQUFFLHVCQUF1QjtLQUNuQztHQUNGLENBQUE7Q0FDRjtBQUNELFNBQVMsWUFBWSxDQUFFLEtBQUssRUFBRTtBQUFFLFNBQU8sRUFBRSxLQUFLLEVBQUwsS0FBSyxFQUFFLFNBQVMsRUFBRSxtREFBbUQsRUFBRSxDQUFBO0NBQUU7QUFDbEgsU0FBUyxVQUFVLENBQUUsUUFBUSxFQUFFO0FBQUUsU0FBTyxZQUFZLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Q0FBRSIsImZpbGUiOiIvaG9tZS9teXVnYS8uYXRvbS9wYWNrYWdlcy9nby1kZWJ1Zy9saWIvZGVsdmUtdmFyaWFibGVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZSAocmF3VmFyaWFibGVzKSB7XG4gIGNvbnN0IHZhcmlhYmxlcyA9IHt9XG5cbiAgZnVuY3Rpb24gYWRkVmFyaWFibGUgKHBhcmVudFBhdGgsIHZhcmlhYmxlKSB7XG4gICAgY29uc3QgcGF0aCA9IHBhdGhKb2luKHBhcmVudFBhdGgsIHZhcmlhYmxlLnBhdGgpXG4gICAgY29uc3QgeyBjaGlsZHJlbiB9ID0gdmFyaWFibGVcbiAgICB2YXJpYWJsZXNbcGF0aF0gPSB7XG4gICAgICBuYW1lOiB2YXJpYWJsZS5uYW1lLFxuICAgICAgbG9hZGVkOiB0cnVlLFxuICAgICAgaGFzQ2hpbGRyZW46IGNoaWxkcmVuID8gISFjaGlsZHJlbi5sZW5ndGggOiBmYWxzZSxcbiAgICAgIHZhbHVlOiB2YXJpYWJsZS52YWx1ZSxcbiAgICAgIHBhcmVudFBhdGgsXG4gICAgICB0eXBlOiB2YXJpYWJsZS5raW5kXG4gICAgfVxuICAgIGlmIChjaGlsZHJlbikge1xuICAgICAgY2hpbGRyZW4uZm9yRWFjaCgodikgPT4ge1xuICAgICAgICBhZGRWYXJpYWJsZShwYXRoLCB2KVxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICByYXdWYXJpYWJsZXMuZm9yRWFjaCgodmFyaWFibGUpID0+IHtcbiAgICBjb25zdCB2ID0gZmFjdG9yeS52YXJpYWJsZSh2YXJpYWJsZSwgdHJ1ZSlcbiAgICB2LnBhdGggPSB2Lm5hbWUgPSB2YXJpYWJsZS5uYW1lXG4gICAgYWRkVmFyaWFibGUoJycsIHYpXG4gIH0pXG5cbiAgcmV0dXJuIHZhcmlhYmxlc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRXJyb3IgKG1lc3NhZ2UsIG5hbWUgPSAnZXJyJykge1xuICByZXR1cm4ge1xuICAgIFtuYW1lXToge1xuICAgICAgbmFtZSxcbiAgICAgIGxvYWRlZDogdHJ1ZSxcbiAgICAgIGhhc0NoaWxkcmVuOiBmYWxzZSxcbiAgICAgIHZhbHVlOiBmb3JtYXRTdHJpbmcobWVzc2FnZSksXG4gICAgICBwYXJlbnRQYXRoOiAnJyxcbiAgICAgIHR5cGU6ICdpbnRlcmZhY2UnXG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHBhdGhKb2luICguLi5pdGVtcykge1xuICByZXR1cm4gaXRlbXMuZmlsdGVyKChpKSA9PiBpICE9PSAnJykuam9pbignLicpXG59XG5cbmNvbnN0IGZhY3RvcnkgPSB7XG4gIHZhcmlhYmxlICh2YXJpYWJsZSwgdG9wKSB7XG4gICAgbGV0IGtpbmQgPSBLSU5EU1t2YXJpYWJsZS5raW5kXVxuICAgIGlmICh2YXJpYWJsZS51bnJlYWRhYmxlICE9PSAnJykge1xuICAgICAgcmV0dXJuIHsgdmFsdWU6IGAodW5yZWFkYWJsZSAke3ZhcmlhYmxlLnVucmVhZGFibGV9KWAsIGtpbmQgfVxuICAgIH1cblxuICAgIGlmICghdmFyaWFibGUudmFsdWUgJiYgdmFyaWFibGUuYWRkciA9PT0gMCAmJiAhdG9wKSB7XG4gICAgICByZXR1cm4geyB2YWx1ZTogW3Nob3J0VHlwZSh2YXJpYWJsZS50eXBlKSwgbmlsKCldLCBraW5kIH1cbiAgICB9XG5cbiAgICBpZiAoa2luZC5zdGFydHNXaXRoKCdjb21wbGV4JykpIHtcbiAgICAgIGtpbmQgPSAnY29tcGxleCdcbiAgICB9IGVsc2UgaWYgKCFmYWN0b3J5W2tpbmRdKSB7XG4gICAgICBraW5kID0gJ2RlZmF1bHQnXG4gICAgfVxuICAgIGNvbnN0IHYgPSBmYWN0b3J5W2tpbmRdKHZhcmlhYmxlKVxuICAgIHYua2luZCA9IGtpbmRcbiAgICByZXR1cm4gdlxuICB9LFxuICBhcnJheSAodmFyaWFibGUpIHtcbiAgICByZXR1cm4gZmFjdG9yeS5zbGljZSh2YXJpYWJsZSlcbiAgfSxcbiAgc2xpY2UgKHZhcmlhYmxlKSB7XG4gICAgY29uc3QgY2hpbGRyZW4gPSB2YXJpYWJsZS5jaGlsZHJlbi5tYXAoKGMsIGkpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIGNoaWxkcmVuIH0gPSBmYWN0b3J5LnZhcmlhYmxlKGMpXG4gICAgICByZXR1cm4geyBwYXRoOiBpLCBuYW1lOiBmb3JtYXROdW1iZXIoaSksIHZhbHVlLCBjaGlsZHJlbiB9XG4gICAgfSlcblxuICAgIGNvbnN0IGRpZmYgPSB2YXJpYWJsZS5sZW4gLSB2YXJpYWJsZS5jaGlsZHJlbi5sZW5ndGhcbiAgICBpZiAoZGlmZiA+IDApIHtcbiAgICAgIGNoaWxkcmVuLnB1c2goeyBwYXRoOiAnbW9yZScsIG5hbWU6IGAuLi4gKyR7ZGlmZn0gbW9yZWAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBraW5kID0gS0lORFNbdmFyaWFibGUua2luZF1cbiAgICBjb25zdCB0eXBlSW5mbyA9IGtpbmQgPT09ICdzbGljZScgJiYgWycobGVuOiAnLCBmb3JtYXROdW1iZXIodmFyaWFibGUubGVuKSwgJywgY2FwOiAnLCBmb3JtYXROdW1iZXIodmFyaWFibGUuY2FwKSwgJyknXVxuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogW3Nob3J0VHlwZSh2YXJpYWJsZS50eXBlKSwgdHlwZUluZm9dLFxuICAgICAgY2hpbGRyZW5cbiAgICB9XG4gIH0sXG4gIHB0ciAodmFyaWFibGUpIHtcbiAgICBjb25zdCBjaGlsZCA9IHZhcmlhYmxlLmNoaWxkcmVuWzBdXG4gICAgaWYgKCFjaGlsZCkge1xuICAgICAgcmV0dXJuIHsgdmFsdWU6IG5pbCgpIH1cbiAgICB9XG5cbiAgICBpZiAodmFyaWFibGUudHlwZSA9PT0gJycpIHtcbiAgICAgIHJldHVybiB7IHZhbHVlOiBuaWwoKSB9XG4gICAgfVxuXG4gICAgaWYgKGNoaWxkLm9ubHlBZGRyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogWycoJywgc2hvcnRUeXBlKHZhcmlhYmxlLnR5cGUpLCAnKSgnLCBmb3JtYXRBZGRyKGNoaWxkKSwgJyknXVxuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB7IHZhbHVlLCBjaGlsZHJlbiB9ID0gZmFjdG9yeS52YXJpYWJsZShjaGlsZClcbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWU6IFsnKicsIHZhbHVlXSxcbiAgICAgIGNoaWxkcmVuXG4gICAgfVxuICB9LFxuICB1bnNhZmVQb2ludGVyICh2YXJpYWJsZSkge1xuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogWyd1bnNhZmUuUG9pbnRlcignLCBmb3JtYXRBZGRyKHZhcmlhYmxlLmNoaWxkcmVuWzBdKSwgJyknXVxuICAgIH1cbiAgfSxcbiAgc3RyaW5nICh2YXJpYWJsZSkge1xuICAgIHJldHVybiBmb3JtYXRTdHJpbmcodmFyaWFibGUudmFsdWUsIHZhcmlhYmxlLmxlbiAtIHZhcmlhYmxlLnZhbHVlLmxlbmd0aClcbiAgfSxcbiAgY2hhbiAodmFyaWFibGUpIHtcbiAgICAvLyBjb3VsZCBhbHNvIGJlIHJlbmRlcmVkIGFzIHN0cnVjdFxuICAgIC8vIHJldHVybiBmYWN0b3J5LnN0cnVjdCh2YXJpYWJsZSlcblxuICAgIGxldCBjb250ZW50XG4gICAgaWYgKHZhcmlhYmxlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29udGVudCA9IG5pbCgpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGMwID0gZmFjdG9yeS52YXJpYWJsZSh2YXJpYWJsZS5jaGlsZHJlblswXSlcbiAgICAgIGNvbnN0IGMxID0gZmFjdG9yeS52YXJpYWJsZSh2YXJpYWJsZS5jaGlsZHJlblsxXSlcbiAgICAgIGlmIChjMC5jaGlsZHJlbikge1xuICAgICAgICBjb25zb2xlLmxvZyh2YXJpYWJsZS5jaGlsZHJlblswXSlcbiAgICAgIH1cbiAgICAgIGlmIChjMS5jaGlsZHJlbikge1xuICAgICAgICBjb25zb2xlLmxvZyh2YXJpYWJsZS5jaGlsZHJlblsxXSlcbiAgICAgIH1cbiAgICAgIGNvbnRlbnQgPSBbJyAnLCBjMC52YWx1ZSwgJy8nLCBjMS52YWx1ZV1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbHVlOiBbc2hvcnRUeXBlKHZhcmlhYmxlLnR5cGUpLCBjb250ZW50XVxuICAgIH1cbiAgfSxcbiAgc3RydWN0ICh2YXJpYWJsZSkge1xuICAgIGNvbnN0IHR5cGUgPSBzaG9ydFR5cGUodmFyaWFibGUudHlwZSlcbiAgICBjb25zdCBkaWZmID0gdmFyaWFibGUubGVuIC0gdmFyaWFibGUuY2hpbGRyZW4ubGVuZ3RoXG4gICAgaWYgKGRpZmYgPiAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogW1xuICAgICAgICAgIHR5cGUgJiYgWycoKicsIHR5cGUsICcpJ10sXG4gICAgICAgICAgJygnLCBmb3JtYXRBZGRyKHZhcmlhYmxlKSwgJyknXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjaGlsZHJlbiA9IHZhcmlhYmxlLmNoaWxkcmVuLm1hcCgoYykgPT4ge1xuICAgICAgY29uc3QgeyB2YWx1ZSwgY2hpbGRyZW4gfSA9IGZhY3RvcnkudmFyaWFibGUoYylcbiAgICAgIHJldHVybiB7IHBhdGg6IGMubmFtZSwgbmFtZTogYy5uYW1lLCB2YWx1ZSwgY2hpbGRyZW4gfVxuICAgIH0pXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbHVlOiB0eXBlLFxuICAgICAgY2hpbGRyZW5cbiAgICB9XG4gIH0sXG4gIGludGVyZmFjZSAodmFyaWFibGUpIHtcbiAgICBjb25zdCBjaGlsZCA9IHZhcmlhYmxlLmNoaWxkcmVuWzBdXG4gICAgaWYgKGNoaWxkLmtpbmQgPT09IDAgJiYgY2hpbGQuYWRkciA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IFtzaG9ydFR5cGUodmFyaWFibGUudHlwZSksIG5pbCgpXVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIG5pY2VyIGhhbmRsaW5nIGZvciBlcnJvcnNcbiAgICBpZiAodmFyaWFibGUudHlwZSA9PT0gJ2Vycm9yJyAmJiBjaGlsZC50eXBlID09PSAnKmVycm9ycy5lcnJvclN0cmluZycpIHtcbiAgICAgIGNvbnN0IGMgPSBjaGlsZC5jaGlsZHJlblswXVxuICAgICAgaWYgKGMpIHtcbiAgICAgICAgY29uc3QgZXJyID0gYy5jaGlsZHJlblswXVxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbHVlOiBbXG4gICAgICAgICAgICAgICdlcnJvciAnLFxuICAgICAgICAgICAgICBmYWN0b3J5LnZhcmlhYmxlKGVycikudmFsdWVcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBbJ2Vycm9yKCcsIGZvcm1hdEFkZHIoY2hpbGQpLCAnKSddXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgeyB2YWx1ZSwgY2hpbGRyZW4gfSA9IGZhY3RvcnkudmFyaWFibGUoY2hpbGQpXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbHVlOiBbc2hvcnRUeXBlKHZhcmlhYmxlLnR5cGUpLCAnICgnLCB2YWx1ZSwgJyknXSxcbiAgICAgIGNoaWxkcmVuXG4gICAgfVxuICB9LFxuICBtYXAgKHZhcmlhYmxlKSB7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBbXVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFibGUuY2hpbGRyZW4ubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgIGNvbnN0IHsgdmFsdWU6IGt2LCBjaGlsZHJlbjoga2MgfSA9IGZhY3RvcnkudmFyaWFibGUodmFyaWFibGUuY2hpbGRyZW5baV0pXG4gICAgICBjb25zdCB7IHZhbHVlOiB2diwgY2hpbGRyZW46IHZjIH0gPSBmYWN0b3J5LnZhcmlhYmxlKHZhcmlhYmxlLmNoaWxkcmVuW2kgKyAxXSlcbiAgICAgIGlmICgha2MgJiYgIXZjKSB7XG4gICAgICAgIGNoaWxkcmVuLnB1c2goeyBwYXRoOiBpLCBuYW1lOiBrdiwgdmFsdWU6IHZ2IH0pXG4gICAgICB9IGVsc2UgaWYgKCFrYykge1xuICAgICAgICBjaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICBwYXRoOiBpLFxuICAgICAgICAgIG5hbWU6IGt2LFxuICAgICAgICAgIHZhbHVlOiB2dixcbiAgICAgICAgICBjaGlsZHJlbjogdmNcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNoaWxkcmVuLnB1c2goe1xuICAgICAgICAgIHBhdGg6IGksXG4gICAgICAgICAgbmFtZTogJ3sga2V5LCB2YWx1ZSB9JyxcbiAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgeyBwYXRoOiAna2V5JywgbmFtZTogJ2tleScsIHZhbHVlOiBrdiwgY2hpbGRyZW46IGtjIH0sXG4gICAgICAgICAgICB7IHBhdGg6ICd2YWx1ZScsIG5hbWU6ICd2YWx1ZScsIHZhbHVlOiB2diwgY2hpbGRyZW46IHZjIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGlmZiA9IHZhcmlhYmxlLmxlbiAtICh2YXJpYWJsZS5jaGlsZHJlbi5sZW5ndGggLyAyKVxuICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgY2hpbGRyZW4ucHVzaCh7IHBhdGg6ICdtb3JlJywgbmFtZTogYC4uLiArJHtkaWZmfSBtb3JlYCB9KVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogc2hvcnRUeXBlKHZhcmlhYmxlLnR5cGUpLFxuICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgfVxuICB9LFxuICBmdW5jICh2YXJpYWJsZSkge1xuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogdmFyaWFibGUudmFsdWUgPyBzaG9ydFR5cGUodmFyaWFibGUudmFsdWUpIDogbmlsKClcbiAgICB9XG4gIH0sXG4gIGNvbXBsZXggKHZhcmlhYmxlKSB7XG4gICAgY29uc3QgeyB2YWx1ZTogdjAgfSA9IGZhY3RvcnkudmFyaWFibGUodmFyaWFibGUuY2hpbGRyZW5bMF0pXG4gICAgY29uc3QgeyB2YWx1ZTogdjEgfSA9IGZhY3RvcnkudmFyaWFibGUodmFyaWFibGUuY2hpbGRyZW5bMV0pXG4gICAgcmV0dXJuIHsgdmFsdWU6IFsnKCcsIHYwLCAnICsgJywgdjEsICdpKSddIH1cbiAgfSxcbiAgZGVmYXVsdCAodmFyaWFibGUpIHtcbiAgICBjb25zdCBraW5kID0gS0lORFNbdmFyaWFibGUua2luZF1cbiAgICBsZXQgY2xhc3NOYW1lXG4gICAgaWYgKHZhcmlhYmxlLnZhbHVlKSB7XG4gICAgICBpZiAoa2luZC5tYXRjaChOVU1FUklDX1JFR0VYKSkge1xuICAgICAgICBjbGFzc05hbWUgPSAnc3ludGF4LS1jb25zdGFudCBzeW50YXgtLW51bWVyaWMgY29uc3RhbnQgbnVtZXJpYydcbiAgICAgIH0gZWxzZSBpZiAoa2luZCA9PT0gJ2Jvb2wnKSB7XG4gICAgICAgIGNsYXNzTmFtZSA9ICdzeW50YXgtLWNvbnN0YW50IHN5bnRheC0tbGFuZ3VhZ2UgbGFuZ3VhZ2UnXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogeyBjbGFzc05hbWUsIHZhbHVlOiB2YXJpYWJsZS52YWx1ZSB8fCAnKHVua25vd24gJyArIEtJTkRTW3ZhcmlhYmxlLmtpbmRdICsgJyknIH1cbiAgICB9XG4gIH1cbn1cblxuY29uc3QgTlVNRVJJQ19SRUdFWCA9IC9eKHUpPyhpbnR8ZmxvYXQpL1xuY29uc3QgS0lORFMgPSBbXG4gICdpbnZhbGlkJyxcbiAgJ2Jvb2wnLFxuICAnaW50JyxcbiAgJ2ludDgnLFxuICAnaW50MTYnLFxuICAnaW50MzInLFxuICAnaW50NjQnLFxuICAndWludCcsXG4gICd1aW50OCcsXG4gICd1aW50MTYnLFxuICAndWludDMyJyxcbiAgJ3VpbnQ2NCcsXG4gICd1aW50cHRyJyxcbiAgJ2Zsb2F0MzInLFxuICAnZmxvYXQ2NCcsXG4gICdjb21wbGV4NjQnLFxuICAnY29tcGxleDEyOCcsXG4gICdhcnJheScsXG4gICdjaGFuJyxcbiAgJ2Z1bmMnLFxuICAnaW50ZXJmYWNlJyxcbiAgJ21hcCcsXG4gICdwdHInLFxuICAnc2xpY2UnLFxuICAnc3RyaW5nJyxcbiAgJ3N0cnVjdCcsXG4gICd1bnNhZmVQb2ludGVyJ1xuICAvLyB0b3RhbDogMjcuLi5cbl1cblxuZnVuY3Rpb24gc2hvcnRUeXBlICh0eXBlKSB7XG4gIGlmICghdHlwZSkge1xuICAgIHJldHVybiAnJ1xuICB9XG4gIGlmICh0eXBlLnN0YXJ0c1dpdGgoJ21hcFsnKSkge1xuICAgIGNvbnN0IHBhcnRzID0gdHlwZS5zcGxpdCgnXScpXG4gICAgaWYgKHBhcnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgIC8vIFRPRE86IHRoaXMgZG9lcyBub3Qgd29yayBmb3IgY29tcGxleCB0eXBlc1xuICAgICAgLy8gXCJtYXBbZmxvYXQzMl1tYXBbaW50XXN0cmluZ1wiXG4gICAgICAvLyBcIm1hcFtzdHJpbmddWzJdaW50MzJcIlxuICAgICAgLy8gXCJtYXBbc3RyaW5nXWZ1bmMoKm5ldC9odHRwLlNlcnZlciwgKmNyeXB0by90bHMuQ29ubiwgbmV0L2h0dHAuSGFuZGxlcilcIlxuICAgICAgLy8gXCJtYXBbc3RyaW5nXW1hcFtzdHJpbmddZ2l0aHViLmNvbS9uaWNrc255ZGVyL2dvLWkxOG4vaTE4bi90cmFuc2xhdGlvbi5UcmFuc2xhdGlvblwiXG4gICAgICAvLyBcIm1hcFtuZXQvaHR0cC5odHRwMkZyYW1lVHlwZV1tYXBbbmV0L2h0dHAuaHR0cDJGbGFnc11zdHJpbmdcIlxuICAgICAgcmV0dXJuIHR5cGVcbiAgICB9XG4gICAgcmV0dXJuIFsnbWFwWycsIHNob3J0VHlwZShwYXJ0c1swXS5zdWJzdHIoNCkpLCAnXScsIHNob3J0VHlwZShwYXJ0c1sxXSldXG4gIH1cbiAgaWYgKHR5cGUuc3RhcnRzV2l0aCgnc3RydWN0ICcpKSB7XG4gICAgdHlwZSA9IHR5cGUuc3Vic3RyKCdzdHJ1Y3QgJy5sZW5ndGgpXG4gIH1cbiAgbGV0IHQgPSAnJ1xuICBpZiAodHlwZS5zdGFydHNXaXRoKCdbJykpIHtcbiAgICBsZXQgY2xvc2luZ0luZGV4ID0gdHlwZS5pbmRleE9mKCddJylcbiAgICBpZiAoY2xvc2luZ0luZGV4ID49IDApIHtcbiAgICAgIGNsb3NpbmdJbmRleCsrXG4gICAgICB0ID0gdHlwZS5zdWJzdHJpbmcoMCwgY2xvc2luZ0luZGV4KVxuICAgICAgdHlwZSA9IHR5cGUuc3Vic3RyaW5nKGNsb3NpbmdJbmRleClcbiAgICB9XG4gIH1cbiAgaWYgKHR5cGUuc3RhcnRzV2l0aCgnKicpKSB7XG4gICAgdCArPSAnKidcbiAgICB0eXBlID0gdHlwZS5zdWJzdHJpbmcoMSlcbiAgfVxuICB0ICs9IHR5cGUuc3BsaXQoJy8nKS5wb3AoKVxuICByZXR1cm4gdFxufVxuZnVuY3Rpb24gbmlsICgpIHsgcmV0dXJuIHsgdmFsdWU6ICcgbmlsJywgY2xhc3NOYW1lOiAnc3ludGF4LS1jb25zdGFudCBzeW50YXgtLWxhbmd1YWdlIGNvbnN0YW50IGxhbmd1YWdlJyB9IH1cbmZ1bmN0aW9uIGZvcm1hdFN0cmluZyAodmFsdWUsIG1vcmUgPSAwKSB7XG4gIHJldHVybiB7XG4gICAgdmFsdWU6IHtcbiAgICAgIHZhbHVlOiBbXG4gICAgICAgICdcIicgKyB2YWx1ZSArICdcIicsXG4gICAgICAgIG1vcmUgPiAwID8gYC4uLiArJHttb3JlfSBtb3JlYCA6IG51bGxcbiAgICAgIF0sXG4gICAgICBjbGFzc05hbWU6ICdzeW50YXgtLXN0cmluZyBzdHJpbmcnXG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmb3JtYXROdW1iZXIgKHZhbHVlKSB7IHJldHVybiB7IHZhbHVlLCBjbGFzc05hbWU6ICdzeW50YXgtLWNvbnN0YW50IHN5bnRheC0tbnVtZXJpYyBjb25zdGFudCBudW1lcmljJyB9IH1cbmZ1bmN0aW9uIGZvcm1hdEFkZHIgKHZhcmlhYmxlKSB7IHJldHVybiBmb3JtYXROdW1iZXIoJzB4JyArIHZhcmlhYmxlLmFkZHIudG9TdHJpbmcoMTYpKSB9XG4iXX0=